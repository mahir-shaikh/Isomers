{"version":3,"file":"jsCalc.min.js","sources":["jsCalc.src.js"],"sourcesContent":["(function (global, factory) {\n\ttypeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\n\ttypeof define === 'function' && define.amd ? define(factory) :\n\t(global.jsCalc = factory());\n}(this, (function () { 'use strict';\n\nif (!window.isArray) {\n    window.isArray = function (obj) {\n        return Object.prototype.toString.call(obj) === '[object Array]';\n    };\n}\nfunction cleanFloat(number) {\n    return number;\n}\n\nvar jsCalcValue = {};\njsCalcValue.makeValue = function (value) {\n    switch (typeof value) {\n    case 'string':\n        if (value.toUpperCase() == 'TRUE' || value.toUpperCase() == 'FALSE') {\n            var val = new jsCalcValue.jsCalcBooleanValue(value);\n            return val;\n        } else if (parseFloat(value) && !isNaN(Number(value))) {\n            var val = new jsCalcValue.jsCalcNumValue(parseFloat(value));\n            return val;\n        } else {\n            var val = new jsCalcValue.jsCalcStringValue(value);\n            return val;\n        }\n    case 'number':\n        var val = new jsCalcValue.jsCalcNumValue(parseFloat(value));\n        return val;\n    case 'boolean':\n        var val = new jsCalcValue.jsCalcBooleanValue(value);\n        return val;\n    default:\n        return -1;\n    }\n};\njsCalcValue.NumValue = function (value) {\n    value = cleanFloat(value);\n    var val = new jsCalcValue.jsCalcNumValue(value);\n    return val;\n};\njsCalcValue.ReferenceValue = function (startRow, startCol, endRow, endCol, cellCtx, sheetName) {\n    return new jsCalcValue.jsCalcReferenceValue(startRow, startCol, endRow, endCol, cellCtx, sheetName);\n};\njsCalcValue.BooleanValue = function (value) {\n    var val = new jsCalcValue.jsCalcBooleanValue(value);\n    return val;\n};\njsCalcValue.StringValue = function (value) {\n    var val = new jsCalcValue.jsCalcStringValue(value);\n    return val;\n};\njsCalcValue.ErrorValue = function (value, ctx, text) {\n    var val = new jsCalcValue.jsCalcErrorValue(value, ctx, text);\n    return val;\n};\njsCalcValue.jsCalcBooleanValue = function (value) {\n    if (value.toUpperCase) {\n        if (value.toUpperCase() == 'FALSE') {\n            this.data = false;\n        } else if (value.toUpperCase() == 'TRUE') {\n            this.data = true;\n        } else {\n            this.data = value ? true : false;\n        }\n    } else {\n        this.data = value ? true : false;\n    }\n};\njsCalcValue.jsCalcBooleanValue.prototype.num = function (ctx) {\n    return this.data ? 1 : 0;\n};\njsCalcValue.jsCalcBooleanValue.prototype.b = function (ctx) {\n    return this.data;\n};\njsCalcValue.jsCalcBooleanValue.prototype.s = function (ctx) {\n    return this.data ? 'True' : 'False';\n};\njsCalcValue.jsCalcBooleanValue.prototype.v = function (ctx) {\n    return this.data == true;\n};\njsCalcValue.jsCalcBooleanValue.prototype.each = function (func, ctx) {\n    func.call(this, ctx);\n};\njsCalcValue.jsCalcBooleanValue.prototype.eachCell = function (func, ctx) {\n    func.call(this, ctx);\n};\njsCalcValue.jsCalcBooleanValue.prototype.isBlank = false;\njsCalcValue.jsCalcNumValue = function (value) {\n    this.data = value;\n};\njsCalcValue.jsCalcNumValue.prototype.num = function (ctx) {\n    return this.data;\n};\njsCalcValue.jsCalcNumValue.prototype.b = function (ctx) {\n    return this.data ? true : false;\n};\njsCalcValue.jsCalcNumValue.prototype.s = function (ctx) {\n    return this.data.toString();\n};\njsCalcValue.jsCalcNumValue.prototype.v = function (ctx) {\n    return this.data;\n};\njsCalcValue.jsCalcNumValue.prototype.each = function (func, ctx) {\n    func.call(this, ctx);\n};\njsCalcValue.jsCalcNumValue.prototype.eachCell = function (func, ctx) {\n    func.call(this, ctx);\n};\njsCalcValue.jsCalcNumValue.prototype.isBlank = false;\njsCalcValue.jsCalcReferenceValue = function (startRow, startCol, endRow, endCol, cellCtx, sheetName, sheetOb) {\n    if (!cellCtx) {\n        alert('set cellCtx in caller');\n    }\n    this.startRow = parseInt(startRow);\n    this.startCol = parseInt(startCol);\n    this.endRow = parseInt(endRow ? endRow : startRow);\n    this.endCol = parseInt(endCol ? endCol : startCol);\n    this.h = this.endRow - this.startRow + 1;\n    this.w = this.endCol - this.startCol + 1;\n    this.count = this.h * this.w;\n    if (this.h == 1) {\n        this.index = jsCalcValue.jsCalcReferenceValue.colIndex;\n    } else if (this.w == 1) {\n        this.index = jsCalcValue.jsCalcReferenceValue.rowIndex;\n    } else {\n        this.index = jsCalcValue.jsCalcReferenceValue.fullIndex;\n    }\n    if (sheetOb) {\n        this.targetSheetOb = sheetOb;\n    }\n    if (!this.targetSheetOb && sheetName) {\n        this.targetSheetOb = cellCtx.workbook.worksheets[sheetName];\n    }\n    if (!this.targetSheetOb && cellCtx.worksheet) {\n        this.targetSheetOb = cellCtx.worksheet;\n    }\n    if (!this.targetSheetOb) {\n        console.log('Didn\\'t manage to find a worksheet reference for:', sheetName, '!R' + startRow + 'C' + endRow);\n    }\n    if (this.startRow == this.endRow && this.startCol == this.endCol) {\n        this.num = function (ctx) {\n            var ref = this.getSingleCellReference();\n            if (ref.value.errorContext)\n                return ref.value.num(ctx);\n            return ref.value.num(ref);\n        };\n        this.b = function (ctx) {\n            var ref = this.getSingleCellReference();\n            if (ref.value.errorContext)\n                return ref.value.b(ctx);\n            return ref.value.b(ref);\n        };\n        this.s = function (ctx) {\n            var ref = this.getSingleCellReference();\n            if (ref.value.errorContext)\n                return ref.value.s(ctx);\n            return ref.value.s(ref);\n        };\n        this.v = function (ctx) {\n            var ref = this.getSingleCellReference();\n            if (ref.value.errorContext)\n                return ref.value.v(ctx);\n            if (ref === ctx) {\n                throw new Error('Infinite loop evaluating cell');\n            }\n            return ref.value.v(ref);\n        };\n    } else {\n        this.num = function (ctx) {\n            return this.getReference(ctx).num(ctx);\n        };\n        this.b = function (ctx) {\n            return this.getReference(ctx).b(ctx);\n        };\n        this.s = function (ctx) {\n            var ref = this.getReference(ctx);\n            return ref.s(ctx);\n        };\n        this.v = function (ctx) {\n            var ref = this.getReference(ctx);\n            return ref.v(ctx);\n        };\n    }\n};\njsCalcValue.jsCalcReferenceValue.prototype.setValue = function (value) {\n    if (window.isArray(value)) {\n    } else {\n        var ref = this.getSingleCellReference();\n        ref.setValue(value);\n    }\n};\njsCalcValue.jsCalcReferenceValue.prototype.get = function (n) {\n    var row = 1 + Math.floor(n / this.w);\n    var col = 1 + n % this.w;\n    return new jsCalcValue.jsCalcReferenceValue(this.startRow + row - 1, this.startCol + col - 1, this.startRow + row - 1, this.startCol + col - 1, this.targetSheetOb.getCell(this.startRow + row - 1, this.startCol + col - 1), this.targetSheetOb.name, this.targetSheetOb);\n};\njsCalcValue.jsCalcReferenceValue.prototype.getByIndex = function (row, col) {\n    return new jsCalcValue.jsCalcReferenceValue(this.startRow + row - 1, this.startCol + col - 1, this.startRow + row - 1, this.startCol + col - 1, this.targetSheetOb.getCell(this.startRow + row - 1, this.startCol + col - 1), this.targetSheetOb.name, this.targetSheetOb);\n};\njsCalcValue.jsCalcReferenceValue.prototype.getCellByIndex = function (row, col) {\n    return this.targetSheetOb.getCell(this.startRow + row, this.startCol + col);\n};\njsCalcValue.jsCalcReferenceValue.prototype.resize = function (h, w) {\n    return new jsCalcValue.jsCalcReferenceValue(this.startRow, this.startCol, this.startRow + h - 1, this.startCol + w - 1, this.targetSheetOb.getCell(this.startRow, this.startCol), this.targetSheetOb.name, this.targetSheetOb);\n};\njsCalcValue.jsCalcReferenceValue.prototype.address = function () {\n    var out = this.targetSheetOb.name + '!R' + this.startRow + 'C' + this.startCol;\n    if (this.startRow != this.endRow || this.startCol != this.endCol) {\n        out += ':R' + this.endRow + 'C' + this.endCol;\n    }\n    return out;\n};\njsCalcValue.jsCalcReferenceValue.prototype.getReference = function (ctx) {\n    if (this.h == 1 && this.w == 1) {\n        return this;\n    } else if (ctx.row >= this.startRow && ctx.row <= this.endRow && this.startCol == this.endCol) {\n        return this.targetSheetOb.getCell(ctx.row, this.startCol);\n    } else if (ctx.col >= this.startCol && ctx.col <= this.endCol && this.startRow == this.endRow) {\n        return this.targetSheetOb.getCell(this.startRow, ctx.col);\n    } else\n        return jsCalcValue.ErrorValue(jsCalcValue.jsCalcErrorValue.value, ctx);\n};\njsCalcValue.jsCalcReferenceValue.prototype.getReferenceAsValueReference = function (ctx) {\n    if (this.h == 1 && this.w == 1) {\n        return this;\n    } else if (ctx.row >= this.startRow && ctx.row <= this.endRow && this.startCol == this.endCol) {\n        return jsCalcValue.ReferenceValue(ctx.row, this.startCol, ctx.row, this.startCol, ctx, this.targetSheetOb.name);\n    } else if (ctx.col >= this.startCol && ctx.col <= this.endCol && this.startRow == this.endRow) {\n        return jsCalcValue.ReferenceValue(this.startRow, ctx.col, this.startRow, ctx.col, ctx, this.targetSheetOb.name);\n    } else\n        return jsCalcValue.ErrorValue(jsCalcValue.jsCalcErrorValue.value, ctx);\n};\njsCalcValue.jsCalcReferenceValue.prototype.each = function (func, ctx) {\n    for (var r = this.startRow; r <= this.endRow; r++) {\n        for (var c = this.startCol; c <= this.endCol; c++) {\n            func.call(new jsCalcValue.jsCalcReferenceValue(r, c, r, c, this.targetSheetOb.getCell(r, c), this.targetSheetOb.name, this.targetSheetOb));\n        }\n    }\n};\njsCalcValue.jsCalcReferenceValue.prototype.eachCell = function (func, ctx) {\n    for (var r = this.startRow; r <= this.endRow; r++) {\n        for (var c = this.startCol; c <= this.endCol; c++) {\n            var cell = this.targetSheetOb ? this.targetSheetOb.getCell(r, c) : null;\n            if (cell)\n                func.call(cell);\n        }\n    }\n};\njsCalcValue.jsCalcReferenceValue.prototype.valueArray = function () {\n    var outArray = [];\n    for (var r = this.startRow; r <= this.endRow; r++) {\n        var curRow = [];\n        for (var c = this.startCol; c <= this.endCol; c++) {\n            curRow.push(this.targetSheetOb.getCell(r, c).v());\n        }\n        outArray.push(curRow);\n    }\n    return outArray;\n};\njsCalcValue.jsCalcReferenceValue.fullIndex = function (row, col, ctx) {\n    return new jsCalcValue.jsCalcReferenceValue(this.startRow + row - 1, this.startCol + col - 1, this.startRow + row - 1, this.startCol + col - 1, this.targetSheetOb.getCell(this.startRow + row - 1, this.startCol + col - 1), this.targetSheetOb.name, this.targetSheetOb);\n};\njsCalcValue.jsCalcReferenceValue.rowIndex = function (row, ctx) {\n    return row <= this.h ? new jsCalcValue.jsCalcReferenceValue(this.startRow + row - 1, this.startCol, this.startRow + row - 1, this.startCol, this.targetSheetOb.getCell(this.startRow + row - 1, this.startCol), this.targetSheetOb.name, this.targetSheetOb) : jsCalcValue.ErrorValue(jsCalcValue.jsCalcErrorValue.value, ctx, 'Attempted an out of bounds index');\n};\njsCalcValue.jsCalcReferenceValue.colIndex = function (row, col, ctx) {\n    if (!ctx) {\n        ctx = col;\n        col = row;\n    }\n    return col <= this.w ? new jsCalcValue.jsCalcReferenceValue(this.startRow, this.startCol + col - 1, this.startRow, this.startCol + col - 1, this.targetSheetOb.getCell(this.startRow, this.startCol + col - 1), this.targetSheetOb.name, this.targetSheetOb) : jsCalcValue.ErrorValue(jsCalcValue.jsCalcErrorValue.value, ctx, 'Attempted an out of bounds index');\n};\njsCalcValue.jsCalcReferenceValue.prototype.getSingleCellReference = function (ctx) {\n    return this.targetSheetOb.getCell(this.startRow, this.startCol);\n};\njsCalcValue.jsCalcStringValue = function (value) {\n    this.data = value;\n};\njsCalcValue.jsCalcStringValue.prototype.num = function (ctx) {\n    var dataVal = isNaN(Number(this.data)) ? this.data : parseFloat(this.data);\n    return this.data.length > 0 ? dataVal : 0;\n};\njsCalcValue.jsCalcStringValue.prototype.b = function (ctx) {\n    return this.data.toUpper() == 'TRUE' ? true : false;\n};\njsCalcValue.jsCalcStringValue.prototype.s = function (ctx) {\n    return this.data;\n};\njsCalcValue.jsCalcStringValue.prototype.v = function (ctx) {\n    return this.data;\n};\njsCalcValue.jsCalcStringValue.prototype.each = function (func, ctx) {\n    func.call(this);\n};\njsCalcValue.jsCalcStringValue.prototype.eachCell = function (func, ctx) {\n    func.call(this);\n};\njsCalcValue.jsCalcStringValue.prototype.isBlank = false;\njsCalcValue.jsCalcErrorValue = function (value, ctx, text) {\n    this.data = value;\n    this.errorContext = ctx;\n    this.text = text;\n    if (!ctx.errorStatus)\n        ctx.errorStatus = this;\n};\njsCalcValue.jsCalcErrorValue.uninitialized = '#UNINITIALIZED!';\njsCalcValue.jsCalcErrorValue.ref = '#REF!';\njsCalcValue.jsCalcErrorValue.divideByZero = '#DIV/0!';\njsCalcValue.jsCalcErrorValue.nameErr = '#NAME!';\njsCalcValue.jsCalcErrorValue.num = '#NUM!';\njsCalcValue.jsCalcErrorValue.calc = '#CALCERROR!';\njsCalcValue.jsCalcErrorValue.value = '#VALUE!';\njsCalcValue.jsCalcErrorValue.build = -5;\njsCalcValue.jsCalcErrorValue.na = '#N/A';\njsCalcValue.jsCalcErrorValue.prototype.num = function (ctx) {\n    if (ctx) {\n        if (!ctx.errorStatus || ctx.errorStatus && !ctx.errorStatus.errorContext)\n            ctx.errorStatus = this;\n    }\n    return this.data;\n};\njsCalcValue.jsCalcErrorValue.prototype.b = function (ctx) {\n    if (ctx) {\n        if (!ctx.errorStatus || ctx.errorStatus && !ctx.errorStatus.errorContext)\n            ctx.errorStatus = this;\n    }\n    return this.data;\n};\njsCalcValue.jsCalcErrorValue.prototype.s = function (ctx) {\n    if (ctx) {\n        if (!ctx.errorStatus || ctx.errorStatus && !ctx.errorStatus.errorContext)\n            ctx.errorStatus = this;\n    }\n    return this.data.toString();\n};\njsCalcValue.jsCalcErrorValue.prototype.index = function () {\n    return this;\n};\njsCalcValue.jsCalcErrorValue.prototype.v = function (ctx) {\n    return this;\n};\njsCalcValue.jsCalcErrorValue.prototype.toString = function () {\n    return this.data;\n};\njsCalcValue.jsCalcErrorValue.prototype.each = function (func, ctx) {\n    func.call(this);\n};\njsCalcValue.jsCalcErrorValue.prototype.eachCell = function (func, ctx) {\n};\njsCalcValue.jsCalcMulticellReferenceValue = function (refArray, cellCtx) {\n    this.refs = [];\n    for (var i = 0; i < refArray.length; i++) {\n        var curArrayItem = refArray[i];\n        this.refs.push(jsCalcValue.ReferenceValue(curArrayItem.startRow, curArrayItem.startCol, curArrayItem.endRow, curArrayItem.endCol, cellCtx, curArrayItem.sheetName));\n    }\n};\njsCalcValue.jsCalcMulticellReferenceValue.prototype.each = function (func, ctx) {\n    for (var i = 0; i < this.refs.length; i++) {\n        this.refs[i].each(func, ctx);\n    }\n};\n\nvar WorksheetFunctions = {};\nWorksheetFunctions.sqrt2PI = Math.sqrt(2 * Math.PI);\nWorksheetFunctions.recipSqrt2PI = 1 / Math.sqrt(2 * Math.PI);\nWorksheetFunctions.SUM = function (argArray, ctx) {\n    var curSum = 0;\n    var curCtx = ctx;\n    for (var i = 0; i < argArray.length; i++) {\n        var v1 = argArray[i];\n        var v2 = v1(ctx);\n        var curRange = argArray[i](ctx);\n        curRange.each(function () {\n            curSum += this.num(curCtx);\n        });\n    }\n    return jsCalcValue.NumValue(curSum);\n};\nWorksheetFunctions.PRODUCT = function (argArray, ctx) {\n    var curProduct = 1;\n    var curCtx = ctx;\n    for (var i = 0; i < argArray.length; i++) {\n        var v1 = argArray[i];\n        var v2 = v1(ctx);\n        var curRange = argArray[i](ctx);\n        curRange.each(function () {\n            curProduct *= this.s(ctx) != '' ? this.num(curCtx) : 1;\n        });\n    }\n    return jsCalcValue.NumValue(curProduct);\n};\nWorksheetFunctions.IF = function (argArray, ctx) {\n    if (argArray[0](ctx).b(ctx)) {\n        return argArray[1](ctx);\n    } else {\n        if (argArray[2])\n            return argArray[2](ctx);\n        return jsCalcValue.NumValue(0);\n    }\n};\nWorksheetFunctions.LARGE = function (argArray, ctx) {\n    var valArray = [];\n    var initialRef = argArray[0](ctx);\n    var numIndex = Math.floor(argArray[1](ctx).num(ctx));\n    var curCtx = ctx;\n    argArray[0](ctx).each(function () {\n        valArray.push(this.num(curCtx));\n    });\n    valArray = valArray.sort(function (a, b) {\n        if (b < a)\n            return -1;\n        if (b > a)\n            return 1;\n        return 0;\n    });\n    if (numIndex > valArray.length)\n        return jsCalcValue.ErrorValue(jsCalcValue.jsCalcErrorValue.num, ctx, 'LARGE had index greater than array size');\n    return jsCalcValue.NumValue(valArray[numIndex - 1]);\n};\nWorksheetFunctions.NOT = function (argArray, ctx) {\n    var Bval = argArray[0](ctx).b(ctx);\n    var Vval = argArray[0](ctx).v();\n    return jsCalcValue.BooleanValue(!Bval);\n};\nWorksheetFunctions.ROW = function (argArray, ctx) {\n    var row = argArray[0](ctx).index(1, 1).getSingleCellReference().row;\n    if (row) {\n        return jsCalcValue.NumValue(row);\n    }\n};\nWorksheetFunctions.INDEX = function (argArray, ctx) {\n    var targ = argArray[0](ctx);\n    var ind = argArray[1](ctx).num(ctx);\n    if (argArray[2]) {\n        var ind2 = argArray[2](ctx).num(ctx);\n        if (targ.h == 1) {\n            return targ.index(ind2, ctx);\n        } else if (targ.w == 1) {\n            return targ.index(ind, ctx);\n        } else {\n            return targ.index(ind, ind2, ctx);\n        }\n    } else {\n        return targ.index(ind, ctx);\n    }\n};\nWorksheetFunctions.ISERROR = function (argArray, ctx) {\n    var testVal = argArray[0](ctx).v(ctx);\n    if (testVal.errorContext)\n        return jsCalcValue.BooleanValue(true);\n    else\n        return jsCalcValue.BooleanValue(false);\n};\nWorksheetFunctions.ISBLANK = function (argArray, ctx) {\n    var testVal = argArray[0](ctx).v();\n    return jsCalcValue.BooleanValue(!testVal);\n};\nWorksheetFunctions.IFERROR = function (argArray, ctx) {\n    var testVal = argArray[0](ctx).v(ctx);\n    if (testVal.errorContext) {\n        ctx.errorStatus = null;\n        return argArray[1](ctx);\n    } else\n        return argArray[0](ctx);\n};\nWorksheetFunctions.VLOOKUP = function (argArray, ctx) {\n    var exact = false;\n    if (argArray[3])\n        exact = !argArray[3](ctx).b(ctx);\n    var colOffset = argArray[2](ctx).num(ctx);\n    var testRange = argArray[1](ctx);\n    if (exact) {\n        var out = null;\n        var testValue = argArray[0](ctx).s(ctx);\n        var isNumber = !isNaN(testValue);\n        for (var i = 0; i < testRange.h; i++) {\n            var curTestCell = testRange.index(1 + i, 1).getSingleCellReference();\n            if (!curTestCell.isBlank) {\n                var curTestVal = curTestCell.s();\n                var curIsNumber = !isNaN(curTestVal);\n                if (isNumber || curIsNumber) {\n                    if (curTestVal == testValue) {\n                        out = testRange.index(1 + i, colOffset);\n                        break;\n                    }\n                } else {\n                    if (curTestVal.toLowerCase() == testValue.toLowerCase()) {\n                        out = testRange.index(1 + i, colOffset);\n                        break;\n                    }\n                }\n            }\n        }\n    } else {\n        var out = null;\n        var last = null;\n        var testValue = argArray[0](ctx).num(ctx);\n        var isNumber = !isNaN(testValue);\n        if (!isNumber) {\n            testValue = argArray[0](ctx).s(ctx);\n        }\n        for (var i = 0; i < testRange.h; i++) {\n            var curTestVal = testRange.index(i + 1, 1).num(ctx);\n            var curIsNumber = !isNaN(curTestVal);\n            if (!curIsNumber) {\n                var curTestVal = testRange.index(i + 1, 1).s(ctx);\n            }\n            if (isNumber || curIsNumber) {\n                if (curTestVal == testValue) {\n                    out = testRange.index(i + 1, colOffset);\n                    break;\n                } else if (curTestVal > testValue) {\n                    out = last;\n                    break;\n                }\n            } else {\n                if (curTestVal.toLowerCase() > testValue.toLowerCase()) {\n                    out = testRange.index(i, colOffset);\n                    break;\n                }\n            }\n            last = testRange.index(i + 1, colOffset);\n        }\n        if (out == null) {\n            out = testRange.index(testRange.h, colOffset);\n        }\n    }\n    if (out) {\n        return out;\n    } else {\n        return jsCalcValue.ErrorValue(jsCalcValue.jsCalcErrorValue.na, ctx, 'VLOOKUP didn\\'t find valid result');\n    }\n};\nWorksheetFunctions.HLOOKUP = function (argArray, ctx) {\n    var exact = false;\n    if (argArray[3])\n        exact = !argArray[3](ctx).b(ctx);\n    var rowOffset = argArray[2](ctx).num(ctx);\n    var testRange = argArray[1](ctx);\n    if (exact) {\n        var out = null;\n        var testValue = argArray[0](ctx).s(ctx);\n        var isNumber = !isNaN(testValue);\n        for (var i = 0; i < testRange.w; i++) {\n            var curTestCell = testRange.index(1, 1 + i).getSingleCellReference();\n            if (!curTestCell.isBlank) {\n                var curTestVal = curTestCell.s();\n                var curIsNumber = !isNaN(curTestVal);\n                if (isNumber || curIsNumber) {\n                    if (curTestVal == testValue) {\n                        out = testRange.index(rowOffset, 1 + i);\n                        break;\n                    }\n                } else {\n                    if (curTestVal.toLowerCase() == testValue.toLowerCase()) {\n                        out = testRange.index(rowOffset, 1 + i);\n                        break;\n                    }\n                }\n            }\n        }\n    } else {\n        var out = null;\n        var last = null;\n        var testValue = argArray[0](ctx).num(ctx);\n        var isNumber = !isNaN(testValue);\n        if (!isNumber) {\n            testValue = argArray[0](ctx).s(ctx);\n        }\n        for (var i = 0; i < testRange.w; i++) {\n            var curTestVal = testRange.index(1, 1 + i).num(ctx);\n            var curIsNumber = !isNaN(curTestVal);\n            if (!curIsNumber) {\n                var curTestVal = testRange.index(1, i + 1).s(ctx);\n            }\n            if (isNumber || curIsNumber) {\n                if (curTestVal == testValue) {\n                    out = testRange.index(rowOffset, i + 1);\n                    break;\n                } else if (curTestVal > testValue) {\n                    out = last;\n                    break;\n                }\n            } else {\n                if (curTestVal.toLowerCase() > testValue.toLowerCase()) {\n                    out = testRange.index(rowOffset, i);\n                    break;\n                }\n            }\n            last = testRange.index(rowOffset, i + 1);\n        }\n        if (out == null) {\n            out = testRange.index(rowOffset, testRange.w);\n        }\n    }\n    if (out) {\n        return out;\n    } else {\n        return jsCalcValue.ErrorValue(jsCalcValue.jsCalcErrorValue.na, ctx, 'HLOOKUP didn\\'t find valid result');\n    }\n};\nWorksheetFunctions.ABS = function (argArray, ctx) {\n    return jsCalcValue.NumValue(Math.abs(argArray[0](ctx).num(ctx)));\n};\nWorksheetFunctions.AND = function (argArray, ctx) {\n    var out = true;\n    var curCtx = ctx;\n    for (var i = 0; i < argArray.length; i++) {\n        var v1 = argArray[i];\n        var v2 = v1(ctx);\n        var curRange = argArray[i](ctx);\n        var curVal = curRange.each(function () {\n            out = out && this.b(curCtx);\n        });\n    }\n    return jsCalcValue.BooleanValue(out);\n};\nWorksheetFunctions.OR = function (argArray, ctx) {\n    var out = false;\n    var curCtx = ctx;\n    for (var i = 0; i < argArray.length; i++) {\n        var v1 = argArray[i];\n        var v2 = v1(ctx);\n        var curRange = argArray[i](ctx);\n        var curVal = curRange.each(function () {\n            out = out || this.b(curCtx);\n        });\n    }\n    return jsCalcValue.BooleanValue(out);\n};\nWorksheetFunctions.IFNA = function (argArray, ctx) {\n    var testVal = argArray[0](ctx).v(ctx);\n    if (testVal.errorContext) {\n        ctx.errorStatus = null;\n        return argArray[1](ctx);\n    } else\n        return argArray[0](ctx);\n};\nWorksheetFunctions.AVERAGE = function (argArray, ctx) {\n    var out = 0;\n    var count = 0;\n    var curCtx = ctx;\n    for (var i = 0; i < argArray.length; i++) {\n        var v1 = argArray[i];\n        var v2 = v1(ctx);\n        var curRange = argArray[i](ctx);\n        var curVal = curRange.each(function () {\n            count = count + 1;\n            out = out + this.num(curCtx);\n        });\n    }\n    return jsCalcValue.NumValue(out / count);\n};\nWorksheetFunctions.CHOOSE = function (argArray, ctx) {\n    var choice = argArray[0](ctx).num(ctx);\n    return argArray[choice](ctx);\n};\nvar calcHelper = {};\ncalcHelper.createConditionFunction = function (condition) {\n    if (condition.s) {\n        var conditionRef = condition;\n        return function (val, ctx) {\n            return val.s(ctx) == conditionRef.s(ctx);\n        };\n    } else if (condition.toUpperCase() == 'TRUE' || condition.toUpperCase() == '=TRUE') {\n        return function (val, ctx) {\n            return val.b(ctx);\n        };\n    } else if (condition.toUpperCase() == 'FALSE' || condition.toUpperCase() == '=FALSE') {\n        return function (val, ctx) {\n            return !val.b(ctx);\n        };\n    } else {\n        var regex = /^(\\=|\\<\\=|\\>\\=|\\<\\>|\\<|\\>)*([0-9\\.]+)$/i;\n        if (regex.test(condition)) {\n            var regOut = regex.exec(condition);\n            var cmpNum = parseFloat(regOut[2]);\n            switch (regOut[1]) {\n            case '<':\n                return function (a, ctx) {\n                    return a.num(ctx) < cmpNum;\n                };\n                break;\n            case '>':\n                return function (a, ctx) {\n                    return a.num(ctx) > cmpNum;\n                };\n                break;\n            case '>=':\n                return function (a, ctx) {\n                    return a.num(ctx) >= cmpNum;\n                };\n                break;\n            case '<=':\n                return function (a, ctx) {\n                    return a.num(ctx) <= cmpNum;\n                };\n                break;\n            case '<>':\n                return function (a, ctx) {\n                    return a.num(ctx) != cmpNum;\n                };\n                break;\n            case '=':\n            default:\n                return function (a, ctx) {\n                    return a.num(ctx) == cmpNum;\n                };\n                break;\n            }\n        } else {\n            var condString = condition;\n            return function (a, ctx) {\n                return a.s(ctx) == condString;\n            };\n        }\n    }\n};\nWorksheetFunctions.COUNTIF = function (argArray, ctx) {\n    var curCtx = ctx;\n    var v2 = argArray[1](ctx);\n    var curRange = argArray[0](ctx);\n    curRange.each(function () {\n        var tmpNum = Number(this.num(curCtx));\n    });\n    var range = argArray[0](ctx);\n    var condition = argArray[1](ctx).s(ctx);\n    var condFunc = calcHelper.createConditionFunction(condition);\n    var count = 0;\n    var v1 = argArray[0];\n    var v2 = v1(ctx);\n    var curRange = argArray[0](ctx);\n    curRange.each(function () {\n        var tmpNum = Number(this.num(curCtx));\n    });\n    var curVal = curRange.each(function () {\n        var val = this;\n        if (condFunc(val, ctx))\n            count = count + 1;\n    });\n    return jsCalcValue.NumValue(count);\n};\nWorksheetFunctions.SUMIF = function (argArray, ctx) {\n    var range = argArray[0](ctx);\n    var condition = argArray[1](ctx).s(ctx);\n    var condFunc = calcHelper.createConditionFunction(condition);\n    var sum = 0;\n    if (argArray[2]) {\n        var range2 = argArray[2](ctx);\n        var count = range.count > range2.count ? range2.count : range.count;\n        for (var i = 0; i < count; i++) {\n            var testVal = range.get(i);\n            if (condFunc(testVal, ctx))\n                sum = sum + range2.get(i).num(ctx);\n        }\n    } else {\n        for (var i = 0; i < range.count; i++) {\n            var testVal = range.get(i);\n            if (condFunc(testVal, ctx))\n                sum = sum + testVal.num(ctx);\n        }\n    }\n    return jsCalcValue.NumValue(sum);\n};\nWorksheetFunctions.MATCH = function (argArray, ctx) {\n    var val = argArray[0](ctx);\n    var range = argArray[1](ctx);\n    var mode = argArray[2] ? argArray[2](ctx).num(ctx) : 0;\n    if (mode < 0) {\n        for (var i = 0; i < range.count; i++) {\n            var testVal = range.get(i);\n            var testNum = testVal.num(ctx);\n            if (val.num(ctx) == testVal.num(ctx))\n                return jsCalcValue.NumValue(i + 1);\n            else if (val.num(ctx) > testVal.num(ctx)) {\n                if (i == 0) {\n                    break;\n                }\n                return jsCalcValue.NumValue(i);\n            }\n        }\n        if (val.num(ctx) < testVal.num(ctx) && i != 0)\n            return jsCalcValue.NumValue(i);\n    } else if (mode > 0) {\n        for (var i = 0; i < range.count; i++) {\n            var testVal = range.get(i);\n            var testNum = testVal.num(ctx);\n            if (testVal.num(ctx) > val.num(ctx)) {\n                if (i == 0) {\n                    break;\n                }\n                return jsCalcValue.NumValue(i);\n            }\n        }\n        if (val.num(ctx) >= testVal.num(ctx) && i != 0)\n            return jsCalcValue.NumValue(i);\n    } else {\n        for (var i = 0; i < range.count; i++) {\n            var testVal = range.get(i);\n            var testNum = testVal.num(ctx);\n            if (testVal.s(ctx) == val.s(ctx)) {\n                return jsCalcValue.NumValue(i + 1);\n            }\n        }\n    }\n    return jsCalcValue.ErrorValue(jsCalcValue.jsCalcErrorValue.na, ctx, 'Match didn\\'t find valid result');\n};\nWorksheetFunctions.MAX = function (argArray, ctx) {\n    var max = jsCalcValue.NumValue(-99999999999999);\n    var curCtx = ctx;\n    for (var i = 0; i < argArray.length; i++) {\n        var v1 = argArray[i];\n        var v2 = v1(ctx);\n        var curRange = argArray[i](ctx);\n        if (curRange instanceof calcCell) {\n            curRange = curRange.value;\n        }\n        curRange.eachCell(function () {\n            if (!this.isBlank)\n                max = this.num(curCtx) > max.num(curCtx) ? this : max;\n        });\n    }\n    return max;\n};\nWorksheetFunctions.MIN = function (argArray, ctx) {\n    var min = jsCalcValue.NumValue(99999999999999);\n    var curCtx = ctx;\n    for (var i = 0; i < argArray.length; i++) {\n        var v1 = argArray[i];\n        var v2 = v1(ctx);\n        var curRange = argArray[i](ctx);\n        if (curRange instanceof calcCell) {\n            curRange = curRange.value;\n        }\n        curRange.eachCell(function () {\n            if (!this.isBlank)\n                min = this.num(curCtx) < min.num(curCtx) ? this : min;\n        });\n    }\n    return min;\n};\nWorksheetFunctions.NA = function (argArray, ctx) {\n    return jsCalcValue.ErrorValue(jsCalcValue.jsCalcErrorValue.na, ctx, 'NA Function Manually Called');\n};\nWorksheetFunctions.NORMDIST = function (argArray, ctx) {\n    var x = argArray[0](ctx).num(ctx);\n    var mean = argArray[1](ctx).num(ctx);\n    var dev = argArray[2](ctx).num(ctx);\n    var cum = argArray[3](ctx).b(ctx);\n    var invDev = 1 / dev;\n    var curFunc = function (t) {\n        var inExp = (t - mean) / dev;\n        var eExp = -0.5 * inExp * inExp;\n        return Math.pow(Math.E, eExp) * WorksheetFunctions.recipSqrt2PI * invDev;\n    };\n    if (cum) {\n        var cumul = 0;\n        var numSteps = 5000;\n        var stepSize = dev / (numSteps / 5);\n        var curVal;\n        var curCalc;\n        curVal = x;\n        while (numSteps > 0) {\n            curCalc = curFunc(curVal);\n            cumul += curCalc * stepSize;\n            curVal = curVal - stepSize;\n            numSteps -= 1;\n        }\n        curCalc = curFunc(x);\n        return jsCalcValue.NumValue(cumul);\n    } else {\n        return jsCalcValue.NumValue(curFunc(x));\n    }\n};\nWorksheetFunctions.NETWORKDAYS = function (argArray, ctx) {\n    var rawStartDate = TimeToJavaScript(argArray[0](ctx).num(ctx));\n    var rawEndDate = TimeToJavaScript(argArray[1](ctx).num(ctx));\n    var startDate = new Date(rawStartDate);\n    var endDate = new Date(rawEndDate);\n    var haveHolidays = argArray.length > 2;\n    var numHolidays = haveHolidays ? argArray[2](ctx).count : 0;\n    var excelHolidays = haveHolidays ? argArray[2](ctx) : 0;\n    var holidays = [];\n    for (var i = 0; i < numHolidays; i++) {\n        var newHoliday = new Date(TimeToJavaScript(excelHolidays.get(i).num(ctx)));\n        newHoliday.setHours(12);\n        newHoliday.setMinutes(0);\n        newHoliday.setSeconds(0);\n        holidays.push(newHoliday.valueOf());\n    }\n    startDate.setHours(12);\n    startDate.setMinutes(0);\n    startDate.setSeconds(0);\n    endDate.setHours(12);\n    endDate.setMinutes(0);\n    endDate.setSeconds(0);\n    var count = 0;\n    var curDate = startDate;\n    while (curDate <= endDate) {\n        var dayOfWeek = curDate.getDay();\n        var skipHoliday = false;\n        for (var i = 0; i < numHolidays; i++) {\n            skipHoliday = haveHolidays && holidays[i] == curDate.valueOf();\n            if (skipHoliday) {\n                break;\n            }\n        }\n        if (!(dayOfWeek == 6 || dayOfWeek == 0) && !skipHoliday) {\n            count++;\n        }\n        curDate.setDate(curDate.getDate() + 1);\n        curDate.setHours(12);\n        curDate.setMinutes(0);\n        curDate.setSeconds(0);\n    }\n    return jsCalcValue.NumValue(count);\n};\nWorksheetFunctions.NOW = function (argArray, ctx) {\n    return jsCalcValue.NumValue(TimeToExcel(Date.now()));\n};\nWorksheetFunctions.DAY = function (argArray, ctx) {\n    var time = argArray[0](ctx).num(ctx);\n    var date = new Date();\n    date.setTime(TimeToJavaScript(time));\n    return jsCalcValue.NumValue(date.getDate());\n};\nWorksheetFunctions.DATE = function (argArray, ctx) {\n    var year = argArray[0](ctx).num(ctx);\n    var month = argArray[1](ctx).num(ctx);\n    var day = argArray[2](ctx).num(ctx);\n    var date = new Date();\n    date.setMonth(month - 1);\n    date.setFullYear(year);\n    date.setDate(day);\n    return jsCalcValue.NumValue(TimeToExcel(date.getTime()));\n};\nWorksheetFunctions.MONTH = function (argArray, ctx) {\n    var time = argArray[0](ctx).num(ctx);\n    var date = new Date();\n    date.setTime(TimeToJavaScript(time));\n    return jsCalcValue.NumValue(date.getMonth() + 1);\n};\nWorksheetFunctions.EOMONTH = function (argArray, ctx) {\n    var time = argArray[0](ctx).num(ctx);\n    var offset = argArray.length > 1 ? argArray[1](ctx).num(ctx) : 0;\n    var date = new Date();\n    date.setTime(TimeToJavaScript(time));\n    var year = date.getFullYear();\n    var month = date.getMonth();\n    var day = date.getDate();\n    var nextMonth = month + offset + 1;\n    date.setMonth(nextMonth);\n    date.setDate(1);\n    var newTime = date.getTime();\n    newTime = newTime - 86400000;\n    date.setTime(newTime);\n    return jsCalcValue.NumValue(TimeToExcel(date.getTime()));\n};\nWorksheetFunctions.YEAR = function (argArray, ctx) {\n    var time = argArray[0](ctx).num(ctx);\n    var date = new Date();\n    date.setTime(TimeToJavaScript(time));\n    return jsCalcValue.NumValue(date.getFullYear());\n};\nWorksheetFunctions.WEEKDAY = function (argArray, ctx) {\n    var time = argArray[0](ctx).num(ctx);\n    var date = new Date();\n    date.setTime(TimeToJavaScript(time));\n    return jsCalcValue.NumValue(date.getDay() + 1);\n};\nDate.prototype.getWeek = function (startDay) {\n    var excelStartDay = 7;\n    switch (startDay) {\n    case 1:\n        excelStartDay = 7;\n        break;\n    case 2:\n        excelStartDay = 1;\n        break;\n    case 11:\n        excelStartDay = 1;\n        break;\n    case 12:\n        excelStartDay = 2;\n        break;\n    case 13:\n        excelStartDay = 3;\n        break;\n    case 14:\n        excelStartDay = 4;\n        break;\n    case 15:\n        excelStartDay = 5;\n        break;\n    case 16:\n        excelStartDay = 6;\n        break;\n    case 17:\n        excelStartDay = 7;\n        break;\n    case 21:\n        excelStartDay = 1;\n        break;\n    default:\n        excelStartDay = 7;\n        break;\n    }\n    var target = new Date(this.valueOf());\n    var dayNr = (this.getDay() + 6) % 7;\n    target.setDate(target.getDate() - dayNr + 3);\n    var firstDay = target.valueOf();\n    target.setMonth(0, 1);\n    if (target.getDay() != excelStartDay) {\n        target.setMonth(0, 1 + (excelStartDay - target.getDay() + 7) % 7);\n    }\n    return 1 + Math.ceil((firstDay - target) / 604800000);\n};\nWorksheetFunctions.WEEKNUM = function (argArray, ctx) {\n    var time = argArray[0](ctx).num(ctx);\n    var date = new Date();\n    date.setTime(TimeToJavaScript(time));\n    var startDay = argArray.length > 2 ? argArray[2](ctx).num(ctx) : 1;\n    return jsCalcValue.NumValue(date.getWeek(startDay));\n};\nvar TimeToExcel = function (time) {\n    return time / 86400 / 1000 + (25567 + 1);\n};\nvar TimeToJavaScript = function (time) {\n    return (time - (25567 + 1)) * 86400 * 1000;\n};\nWorksheetFunctions.STDEVP = function (argArray, ctx) {\n    var mean = 0;\n    var count = 0;\n    var SSD = 0;\n    var nodes = argArray[0](ctx);\n    var curCtx = ctx;\n    for (var i = 0; i < argArray.length; i++) {\n        var curRange = argArray[i](ctx);\n        curRange.each(function () {\n            mean += this.num(curCtx);\n            count += 1;\n        });\n    }\n    mean /= count;\n    for (var i = 0; i < argArray.length; i++) {\n        var curRange = argArray[i](ctx);\n        curRange.each(function () {\n            SSD += Math.pow(this.num(curCtx) - mean, 2);\n        });\n    }\n    SSD = SSD /= count;\n    var rootPart = Math.sqrt(SSD);\n    return jsCalcValue.NumValue(rootPart);\n};\nWorksheetFunctions.SUMPRODUCT = function (argArray, ctx) {\n    var range = argArray[0](ctx);\n    var sum = 0;\n    if (argArray[1]) {\n        var range2 = argArray[1](ctx);\n        var count = range.count > range2.count ? range2.count : range.count;\n        for (var i = 0; i < count; i++) {\n            sum += range.get(i).num(ctx) * range2.get(i).num(ctx);\n        }\n    } else {\n        return WorksheetFunctions.SUM(argArray, ctx);\n    }\n    return jsCalcValue.NumValue(sum);\n};\nWorksheetFunctions.FLOOR = function (argArray, ctx) {\n    var num = argArray[0](ctx).num(ctx);\n    var multiple = 1;\n    if (argArray[1])\n        multiple = argArray[1](ctx).num(ctx);\n    var roundDown = num % multiple;\n    num = num - roundDown;\n    return jsCalcValue.NumValue(num);\n};\nWorksheetFunctions.ROUND = function (argArray, ctx) {\n    var num = argArray[0](ctx).num(ctx);\n    var numPlaces = 0;\n    if (argArray[1])\n        numPlaces = argArray[1](ctx).num(ctx);\n    var mult = Math.pow(10, numPlaces);\n    num *= mult;\n    num = Math.round(num);\n    num /= mult;\n    return jsCalcValue.NumValue(num);\n};\nWorksheetFunctions.ROUNDDOWN = function (argArray, ctx) {\n    var num = argArray[0](ctx).num(ctx);\n    var numPlaces = 0;\n    if (argArray[1])\n        numPlaces = argArray[1](ctx).num(ctx);\n    var mult = Math.pow(10, numPlaces);\n    num *= mult;\n    num = Math.floor(num);\n    num /= mult;\n    return jsCalcValue.NumValue(num);\n};\nWorksheetFunctions.ROUNDUP = function (argArray, ctx) {\n    var num = argArray[0](ctx).num(ctx);\n    var numPlaces = 0;\n    if (argArray[1])\n        numPlaces = argArray[1](ctx).num(ctx);\n    var mult = Math.pow(10, numPlaces);\n    num *= mult;\n    num = Math.ceil(num);\n    num /= mult;\n    return jsCalcValue.NumValue(num);\n};\nWorksheetFunctions.RANK = function (argArray, ctx) {\n    var testVal = argArray[0](ctx).num(ctx);\n    var range = argArray[1](ctx);\n    var order = 0;\n    if (argArray[2])\n        order = argArray[2](ctx).num(ctx);\n    var greaterCount = 0;\n    var lessCount = 0;\n    for (var i = 0; i < range.count; i++) {\n        var testNum = range.get(i).num(ctx);\n        if (testNum > testVal)\n            greaterCount++;\n        else if (testNum < testVal)\n            lessCount++;\n    }\n    return order ? jsCalcValue.NumValue(lessCount + 1) : jsCalcValue.NumValue(greaterCount + 1);\n};\nWorksheetFunctions.OFFSET = function (argArray, ctx) {\n    var curRange = argArray[0](ctx);\n    var moveRowsBy = argArray[1](ctx).num(ctx);\n    var moveColsBy = argArray[2](ctx).num(ctx);\n    var numRowsToReturn = argArray[3] ? argArray[3](ctx).num(ctx) : 0;\n    numRowsToReturn = numRowsToReturn > 0 ? numRowsToReturn - 1 : numRowsToReturn < 0 ? numRowsToReturn + 1 : numRowsToReturn;\n    var numColsToReturn = argArray[4] ? argArray[4](ctx).num(ctx) : 0;\n    numColsToReturn = numColsToReturn > 0 ? numColsToReturn - 1 : numColsToReturn < 0 ? numColsToReturn + 1 : numColsToReturn;\n    var targetRangeStartRow = curRange.startRow + moveRowsBy || 0, targetRangeStartCol = curRange.startCol + moveColsBy || 0, targetRangeEndRow = targetRangeStartRow + numRowsToReturn || 0, targetRangeEndCol = targetRangeStartCol + numColsToReturn || 0, targetRangeSheetName = curRange.targetSheetOb.name || '';\n    var targetRange = jsCalcValue.ReferenceValue(targetRangeStartRow, targetRangeStartCol, targetRangeEndRow, targetRangeEndCol, ctx, targetRangeSheetName);\n    return targetRange;\n};\nWorksheetFunctions.NPV = function (argArray, ctx) {\n    var rate = argArray[0](ctx).num(ctx);\n    var value = 0;\n    for (var j = 1; j < argArray.length; j++) {\n        if (argArray[j](ctx) instanceof calcCell) {\n            value += argArray[j](ctx).num(ctx) / Math.pow(1 + rate, j);\n        } else {\n            var idx = 0;\n            argArray[j](ctx).eachCell(function () {\n                value += this.num(ctx) / Math.pow(1 + rate, j + idx);\n                idx++;\n            });\n        }\n    }\n    return jsCalcValue.NumValue(value);\n};\nWorksheetFunctions.FORECAST = function (argArray, ctx) {\n    var x = argArray[0](ctx).num(ctx), data_y_ranges = argArray[1](ctx), data_x_ranges = argArray[2](ctx), data_y = [], data_x = [], hasError = false;\n    for (var i = 0; i < data_y_ranges.count; i++) {\n        if (data_y_ranges.get(i).v(ctx).errorContext) {\n            hasError = true;\n            break;\n        }\n        data_y.push(data_y_ranges.get(i).num(ctx) || 0);\n    }\n    for (var i = 0; i < data_x_ranges.count; i++) {\n        if (data_x_ranges.get(i).v(ctx).errorContext) {\n            hasError = true;\n            break;\n        }\n        data_x.push(data_x_ranges.get(i).num(ctx) || 0);\n    }\n    if (hasError) {\n        console.log('Error in calculating forecast', data_x, data_y);\n    }\n    var xmean = getMean(data_x);\n    var ymean = getMean(data_y);\n    var n = data_x.length;\n    var num = 0;\n    var den = 0;\n    for (var i = 0; i < n; i++) {\n        num += (data_x[i] - xmean) * (data_y[i] - ymean);\n        den += Math.pow(data_x[i] - xmean, 2);\n    }\n    var b = num / den;\n    var a = ymean - b * xmean;\n    return jsCalcValue.NumValue(a + b * x);\n};\nfunction getMean(dataArr) {\n    var sum = 0;\n    for (var i = 0; i < dataArr.length; i++) {\n        sum += dataArr[i];\n    }\n    return sum / dataArr.length;\n}\nWorksheetFunctions.VALUE = function (argArray, ctx) {\n    var text = argArray[0](ctx).s(ctx);\n    return jsCalcValue.StringValue(text);\n};\nWorksheetFunctions.LEFT = function (argArray, ctx) {\n    var text = argArray[0](ctx).s(ctx), num = argArray[1] && argArray[1](ctx) && argArray[1](ctx).num(ctx) ? argArray[1](ctx).num(ctx) : 1;\n    text = text ? text.substring(0, num) : null;\n    return jsCalcValue.StringValue(text);\n};\nWorksheetFunctions.RIGHT = function (argArray, ctx) {\n    var text = argArray[0](ctx).s(ctx), num = argArray[1] && argArray[1](ctx) && argArray[1](ctx).num(ctx) ? argArray[1](ctx).num(ctx) : 1;\n    text = text ? text.substring(text.length - num) : null;\n    return jsCalcValue.StringValue(text);\n};\nWorksheetFunctions.LEN = function (argArray, ctx) {\n    var text = argArray[0](ctx).s(ctx);\n    if (typeof text === 'undefined' || text.errorContext) {\n        return jsCalcValue.jsCalcErrorValue(text, ctx, 'Error in calculating length');\n    }\n    if (typeof text === 'string') {\n        return jsCalcValue.NumValue(text ? text.length : 0);\n    }\n    if (text.length) {\n        return jsCalcValue.NumValue(text.length);\n    }\n    return jsCalcValue.jsCalcErrorValue(text, ctx, 'Error in calculating length');\n};\nWorksheetFunctions.SUBSTITUTE = function (argArray, ctx) {\n    var text = argArray[0](ctx).s(ctx), oldText = argArray[1] ? argArray[1](ctx).s(ctx) : '', newText = argArray[2] ? argArray[2](ctx).s(ctx) : '', occurence = argArray[3] ? argArray[3](ctx).num(ctx) : undefined;\n    if (typeof text === 'undefined' || typeof oldText === 'undefined' || typeof newText === 'undefined' || text.errorContext || oldText.errorContext || newText.errorContext) {\n        return jsCalcValue.jsCalcErrorValue(text, ctx, 'Error in substitute function');\n    } else if (occurence === undefined) {\n        var outVal = text.replace(new RegExp(oldText, 'g'), newText);\n        return jsCalcValue.StringValue(outVal);\n    } else {\n        var index = 0;\n        var i = 0;\n        while (text.indexOf(oldText, index) > 0) {\n            index = text.indexOf(oldText, index + 1);\n            i++;\n            if (i === occurence) {\n                var outVal = text.substring(0, index) + newText + text.substring(index + oldText.length);\n                return jsCalcValue.StringValue(outVal);\n            }\n        }\n    }\n};\nWorksheetFunctions.IRR = function (argArray, ctx) {\n    var values = argArray[0](ctx);\n    var guess = argArray[1] ? argArray[1](ctx).num(ctx) : 0;\n    var valuesArray = [], hasError = false;\n    for (var i = 0; i < values.count; i++) {\n        if (values.get(i).v(ctx).errorContext) {\n            hasError = true;\n            break;\n        }\n        valuesArray.push(values.get(i).num(ctx) || 0);\n    }\n    if (hasError) {\n        console.log('Error in calculating IRR');\n        return jsCalcValue.jsCalcErrorValue(values, ctx, 'Error in calculating IRR');\n    }\n    var irrResult = function (values, dates, rate) {\n        var r = rate + 1;\n        var result = values[0];\n        for (var i = 1; i < values.length; i++) {\n            result += values[i] / Math.pow(r, (dates[i] - dates[0]) / 365);\n        }\n        return result;\n    };\n    var irrResultDeriv = function (values, dates, rate) {\n        var r = rate + 1;\n        var result = 0;\n        for (var i = 1; i < values.length; i++) {\n            var frac = (dates[i] - dates[0]) / 365;\n            result -= frac * values[i] / Math.pow(r, frac + 1);\n        }\n        return result;\n    };\n    var dates = [];\n    var positive = false;\n    var negative = false;\n    for (var i = 0; i < valuesArray.length; i++) {\n        dates[i] = i === 0 ? 0 : dates[i - 1] + 365;\n        if (valuesArray[i] > 0) {\n            positive = true;\n        }\n        if (valuesArray[i] < 0) {\n            negative = true;\n        }\n    }\n    if (!positive || !negative) {\n        return jsCalcValue.jsCalcErrorValue(values, ctx, 'Error in calculating IRR');\n    }\n    guess = guess === undefined ? 0.1 : guess;\n    var resultRate = guess;\n    var epsMax = 1e-10;\n    var newRate, epsRate, resultValue;\n    var contLoop = true;\n    do {\n        resultValue = irrResult(valuesArray, dates, resultRate);\n        newRate = resultRate - resultValue / irrResultDeriv(valuesArray, dates, resultRate);\n        epsRate = Math.abs(newRate - resultRate);\n        resultRate = newRate;\n        contLoop = epsRate > epsMax && Math.abs(resultValue) > epsMax;\n    } while (contLoop);\n    return jsCalcValue.NumValue(resultRate);\n};\nWorksheetFunctions.TRIM = function (argArray, ctx) {\n    var text = argArray[0](ctx).s(ctx);\n    if (typeof text === 'undefined' || text.errorContext) {\n        return jsCalcValue.jsCalcErrorValue(text, ctx, 'Error in trimming string');\n    }\n    if (typeof text === 'string') {\n        var tmptext = text.replace(/\\s+/g, ' ');\n        return jsCalcValue.StringValue(tmptext.trim());\n    }\n    return jsCalcValue.jsCalcErrorValue(text, ctx, 'Error in trimming string');\n};\nWorksheetFunctions.INT = function (argArray, ctx) {\n    var val = Math.floor(argArray[0](ctx).num(ctx));\n    return jsCalcValue.NumValue(val);\n};\nWorksheetFunctions.MOD = function (argArray, ctx) {\n    var val1 = argArray[0](ctx).num(ctx);\n    var val2 = argArray[1](ctx).num(ctx);\n    var mod = val1 % val2;\n    return jsCalcValue.NumValue(mod);\n};\n\nvar ExpressionBuilder = function () {\n};\nif (!window.log) {\n    if (window.console) {\n        window.log = console.log;\n    } else {\n        window.log = function () {\n        };\n    }\n}\nExpressionBuilder.valueFunctions = {};\nExpressionBuilder.valueConstructorFunctions = {};\nExpressionBuilder.operatorConstructorFunctions = {};\nExpressionBuilder.resultTypes = {};\nExpressionBuilder.resultTypes.value = 0;\nExpressionBuilder.resultTypes.generic = 1;\nExpressionBuilder.activeWorkbook;\nExpressionBuilder.getEvalFunction = function (expression, cellCtx, asValue) {\n    var asValue = asValue ? true : false;\n    switch (expression.type) {\n    case 'binary':\n        var constructFunc = ExpressionBuilder.operatorConstructorFunctions[expression.operator];\n        return constructFunc(expression.A, expression.B, cellCtx, expression);\n    case 'value':\n        if (expression.value == 'TRUE') {\n            alert('Oops!');\n        }\n        if (ExpressionBuilder.valueFunctions[expression.value]) {\n            return ExpressionBuilder.valueFunctions[expression.value];\n        } else {\n            var type = 'number';\n            var constructFunc = ExpressionBuilder.valueConstructorFunctions[type];\n            ExpressionBuilder.valueFunctions[expression.value] = constructFunc(expression.value);\n            return ExpressionBuilder.valueFunctions[expression.value];\n        }\n    case 'string':\n        if (expression.value.length == 0) {\n            if (ExpressionBuilder.emptyStringFunction)\n                return ExpressionBuilder.emptyStringFunction;\n            var type = 'string';\n            var constructFunc = ExpressionBuilder.valueConstructorFunctions[type];\n            ExpressionBuilder.emptyStringFunction = constructFunc(expression.value);\n            return ExpressionBuilder.emptyStringFunction;\n        } else if (ExpressionBuilder.valueFunctions[expression.value]) {\n            return ExpressionBuilder.valueFunctions[expression.value];\n        } else {\n            var type = 'string';\n            var constructFunc = ExpressionBuilder.valueConstructorFunctions[type];\n            ExpressionBuilder.valueFunctions[expression.value] = constructFunc(expression.value);\n            return ExpressionBuilder.valueFunctions[expression.value];\n        }\n    case 'bool':\n        if (ExpressionBuilder.valueFunctions[expression.value]) {\n            return ExpressionBuilder.valueFunctions[expression.value];\n        } else {\n            var type = 'bool';\n            var constructFunc = ExpressionBuilder.valueConstructorFunctions[type];\n            ExpressionBuilder.valueFunctions[expression.value] = constructFunc(expression.value);\n            return ExpressionBuilder.valueFunctions[expression.value];\n        }\n    case 'reference':\n        return ExpressionBuilder.referenceConstructorFunction(expression, cellCtx, asValue);\n    case 'namedRangeReference':\n        return ExpressionBuilder.namedReferenceConstructorFunction(expression, cellCtx, asValue);\n    case 'wsFunc':\n        return ExpressionBuilder.worksheetFunctionConstructor(expression, cellCtx);\n    }\n};\nExpressionBuilder.valueConstructorFunctions.number = function (value) {\n    var val = jsCalcValue.NumValue(parseFloat(value));\n    return function () {\n        return val;\n    };\n};\nExpressionBuilder.valueConstructorFunctions.string = function (value) {\n    var val = jsCalcValue.StringValue(value);\n    return function () {\n        return val;\n    };\n};\nExpressionBuilder.valueConstructorFunctions.bool = function (value) {\n    var val = jsCalcValue.BooleanValue(value);\n    return function () {\n        return val;\n    };\n};\nExpressionBuilder.operatorConstructorFunctions.add = function (A, B, cellCtx, expression) {\n    var funcA = ExpressionBuilder.getEvalFunction(A, cellCtx, true);\n    var funcB = ExpressionBuilder.getEvalFunction(B, cellCtx, true);\n    var curExpression = expression;\n    return function (ctx) {\n        var A = funcA(ctx);\n        if (A.errorContext)\n            return A;\n        var B = funcB(ctx);\n        if (B.errorContext)\n            return B;\n        curExpression.curVal = jsCalcValue.NumValue(A.num(ctx) + B.num(ctx));\n        return curExpression.curVal;\n    };\n};\nExpressionBuilder.operatorConstructorFunctions.sub = function (A, B, cellCtx, expression) {\n    var funcA = ExpressionBuilder.getEvalFunction(A, cellCtx, true);\n    var funcB = ExpressionBuilder.getEvalFunction(B, cellCtx, true);\n    var curExpression = expression;\n    return function (ctx) {\n        curExpression.curVal = jsCalcValue.NumValue(funcA(ctx).num(ctx) - funcB(ctx).num(ctx));\n        return curExpression.curVal;\n    };\n};\nExpressionBuilder.operatorConstructorFunctions.mul = function (A, B, cellCtx, expression) {\n    var funcA = ExpressionBuilder.getEvalFunction(A, cellCtx, true);\n    var funcB = ExpressionBuilder.getEvalFunction(B, cellCtx, true);\n    var curExpression = expression;\n    return function (ctx) {\n        var a = funcA(ctx);\n        var b = funcB(ctx);\n        curExpression.curVal = jsCalcValue.NumValue(funcA(ctx).num(ctx) * funcB(ctx).num(ctx));\n        return curExpression.curVal;\n    };\n};\nExpressionBuilder.operatorConstructorFunctions.exp = function (A, B, cellCtx, expression) {\n    var funcA = ExpressionBuilder.getEvalFunction(A, cellCtx, true);\n    var funcB = ExpressionBuilder.getEvalFunction(B, cellCtx, true);\n    var curExpression = expression;\n    return function (ctx) {\n        var a = funcA(ctx).num(ctx);\n        var b = funcB(ctx).num(ctx);\n        var c = Math.pow(a, b);\n        curExpression.curVal = isNaN(c) || c == Number.POSITIVE_INFINITY || c == Number.NEGATIVE_INFINITY ? jsCalcValue.ErrorValue(jsCalcValue.jsCalcErrorValue.value, ctx, 'Div0 within exp function') : jsCalcValue.NumValue(c);\n        return curExpression.curVal;\n    };\n};\nExpressionBuilder.operatorConstructorFunctions.div = function (A, B, cellCtx, expression) {\n    var funcA = ExpressionBuilder.getEvalFunction(A, cellCtx, true);\n    var funcB = ExpressionBuilder.getEvalFunction(B, cellCtx, true);\n    var curExpression = expression;\n    return function (ctx) {\n        var a = funcA(ctx).num(ctx);\n        var b = funcB(ctx).num(ctx);\n        curExpression.curVal = b ? jsCalcValue.NumValue(funcA(ctx).num(ctx) / funcB(ctx).num(ctx)) : jsCalcValue.ErrorValue(jsCalcValue.jsCalcErrorValue.divideByZero, ctx);\n        return curExpression.curVal;\n    };\n};\nExpressionBuilder.operatorConstructorFunctions.eq = function (A, B, cellCtx, expression) {\n    var funcA = ExpressionBuilder.getEvalFunction(A, cellCtx, true);\n    var funcB = ExpressionBuilder.getEvalFunction(B, cellCtx, true);\n    var curExpression = expression;\n    return function (ctx) {\n        var a = funcA(ctx).s(ctx);\n        var b = funcB(ctx).s(ctx);\n        curExpression.curVal = jsCalcValue.BooleanValue(a == b);\n        return curExpression.curVal;\n    };\n};\nExpressionBuilder.operatorConstructorFunctions.neq = function (A, B, cellCtx, expression) {\n    var funcA = ExpressionBuilder.getEvalFunction(A, cellCtx, true);\n    var funcB = ExpressionBuilder.getEvalFunction(B, cellCtx, true);\n    var curExpression = expression;\n    return function (ctx) {\n        var a = funcA(ctx).s(ctx);\n        var b = funcB(ctx).s(ctx);\n        curExpression.curVal = jsCalcValue.BooleanValue(a != b);\n        return curExpression.curVal;\n    };\n};\nExpressionBuilder.operatorConstructorFunctions.lt = function (A, B, cellCtx, expression) {\n    var funcA = ExpressionBuilder.getEvalFunction(A, cellCtx, true);\n    var funcB = ExpressionBuilder.getEvalFunction(B, cellCtx, true);\n    var curExpression = expression;\n    return function (ctx) {\n        var a = funcA(ctx).num(ctx);\n        var b = funcB(ctx).num(ctx);\n        curExpression.curVal = jsCalcValue.BooleanValue(a < b);\n        return curExpression.curVal;\n    };\n};\nExpressionBuilder.operatorConstructorFunctions.gt = function (A, B, cellCtx, expression) {\n    var funcA = ExpressionBuilder.getEvalFunction(A, cellCtx, true);\n    var funcB = ExpressionBuilder.getEvalFunction(B, cellCtx, true);\n    var curExpression = expression;\n    return function (ctx) {\n        var a = funcA(ctx).num(ctx);\n        var b = funcB(ctx).num(ctx);\n        curExpression.curVal = jsCalcValue.BooleanValue(a > b);\n        return curExpression.curVal;\n    };\n};\nExpressionBuilder.operatorConstructorFunctions.lte = function (A, B, cellCtx, expression) {\n    var funcA = ExpressionBuilder.getEvalFunction(A, cellCtx, true);\n    var funcB = ExpressionBuilder.getEvalFunction(B, cellCtx, true);\n    var curExpression = expression;\n    return function (ctx) {\n        var a = funcA(ctx).num(ctx);\n        var b = funcB(ctx).num(ctx);\n        curExpression.curVal = jsCalcValue.BooleanValue(a <= b);\n        return curExpression.curVal;\n    };\n};\nExpressionBuilder.operatorConstructorFunctions.gte = function (A, B, cellCtx, expression) {\n    var funcA = ExpressionBuilder.getEvalFunction(A, cellCtx, true);\n    var funcB = ExpressionBuilder.getEvalFunction(B, cellCtx, true);\n    var curExpression = expression;\n    return function (ctx) {\n        var a = funcA(ctx).num(ctx);\n        var b = funcB(ctx).num(ctx);\n        curExpression.curVal = jsCalcValue.BooleanValue(a >= b);\n        return curExpression.curVal;\n    };\n};\nExpressionBuilder.operatorConstructorFunctions.cat = function (A, B, cellCtx, expression) {\n    var funcA = ExpressionBuilder.getEvalFunction(A, cellCtx, true);\n    var funcB = ExpressionBuilder.getEvalFunction(B, cellCtx, true);\n    var curExpression = expression;\n    return function (ctx) {\n        var a = funcA(ctx).s(ctx);\n        var b = funcB(ctx).s(ctx);\n        curExpression.curVal = jsCalcValue.StringValue(a + b);\n        return curExpression.curVal;\n    };\n};\nExpressionBuilder.namedReferenceConstructorFunction = function (expression, cellCtx, asValue) {\n    var workbookOb = cellCtx.workbook;\n    var name = expression.name;\n    if (name in workbookOb.namedRanges) {\n        var refOb = workbookOb.namedRanges[name];\n        if (asValue) {\n            refOb = refOb.getReferenceAsValueReference(cellCtx);\n        }\n        cellCtx.parents.push(refOb);\n    } else {\n        window.log('Named range \\'' + name + '\\' is referenced in a formula, but is not defined in the workbook.', cellCtx.address());\n    }\n    var curExpression = expression;\n    return function (ctx) {\n        curExpression.curVal = name in workbookOb.namedRanges ? workbookOb.namedRanges[name] : jsCalcValue.ErrorValue(jsCalcValue.jsCalcErrorValue.nameErr, ctx);\n        return curExpression.curVal;\n    };\n};\nExpressionBuilder.referenceConstructorFunction = function (expression, cellCtx, asValue) {\n    var startRow = expression.startRow;\n    var startCol = expression.startCol;\n    var endRow = expression.endRow ? expression.endRow : startRow;\n    var endCol = expression.endCol ? expression.endCol : startCol;\n    var targetSheet = expression.worksheet ? expression.worksheet : null;\n    var refOb = jsCalcValue.ReferenceValue(startRow, startCol, endRow, endCol, cellCtx, targetSheet);\n    if (asValue) {\n        refOb = refOb.getReferenceAsValueReference(cellCtx);\n    }\n    cellCtx.parents.push(refOb);\n    return ExpressionBuilder.referenceReturnFunction(refOb, expression);\n};\nExpressionBuilder.referenceReturnFunction = function (refOb, expression) {\n    return function (ctx) {\n        return refOb;\n    };\n};\nExpressionBuilder.worksheetFunctionConstructor = function (expression, cellCtx) {\n    var wsFunc = WorksheetFunctions[expression.name];\n    if (!wsFunc) {\n        var errStr = 'Unsupported worksheet function in ' + cellCtx.verboseAddress() + ': ' + expression.name;\n        cellCtx.workbook.buildErrors.push(errStr);\n        if (!cellCtx.workbook.unsupportedFunctionList[expression.name])\n            cellCtx.workbook.unsupportedFunctionList[expression.name] = 1;\n        else\n            cellCtx.workbook.unsupportedFunctionList[expression.name] = cellCtx.workbook.unsupportedFunctionList[expression.name] + 1;\n        cellCtx.errorStatus = jsCalcValue.ErrorValue(jsCalcValue.jsCalcErrorValue.build, cellCtx, errStr);\n        return function (ctx) {\n            return jsCalcValue.ErrorValue(jsCalcValue.jsCalcErrorValue.build, ctx, errStr);\n        };\n    } else {\n        var expArgFuncArray = [];\n        if (expression.argExpressionArray.length) {\n            for (var i = 0; i < expression.argExpressionArray.length; i++) {\n                var funcA = ExpressionBuilder.getEvalFunction(expression.argExpressionArray[i], cellCtx);\n                expArgFuncArray.push(funcA);\n            }\n        } else {\n            expArgFuncArray.push(ExpressionBuilder.getEvalFunction(expression.argExpressionArray, cellCtx));\n        }\n        return ExpressionBuilder.worksheetFunctionReturnFunction(wsFunc, expArgFuncArray, cellCtx, expression);\n    }\n};\nExpressionBuilder.worksheetFunctionReturnFunction = function (func, args, cellCtx, expression) {\n    var curArgs = args;\n    var curFunc = func;\n    var curExpression = expression;\n    return function (ctx) {\n        curExpression.curVal = curFunc(curArgs, ctx, expression);\n        return curExpression.curVal;\n    };\n};\n\nvar calcExcelCell = function (worksheet, row, col, expressionData, isBlank) {\n    this.debugExpressionData = expressionData;\n    var self = this;\n    this.workbook = worksheet.parent;\n    this.worksheet = worksheet;\n    this.row = parseInt(row);\n    this.col = parseInt(col);\n    this.parents = [];\n    this.children = [];\n    this.cleanParentCount = 0;\n    this.isBlank = expressionData == 0 ? true : false;\n    this.breakIf();\n    if (expressionData) {\n        if (expressionData.type == 'value' || expressionData.type == 'string' || expressionData.type == 'bool') {\n            this.workbook.valueCells.push(this);\n            this.isValue = true;\n        } else\n            this.isValue = false;\n        this.errorStatus = null;\n        try {\n            this.expression = ExpressionBuilder.getEvalFunction(expressionData, this, true);\n        } catch (e) {\n            var err = e;\n            this.workbook.buildErrors.push(e.toString());\n            this.expression = function (ctx) {\n                return jsCalcValue.ErrorValue(jsCalcValue.jsCalcErrorValue.build, self, err.toString());\n            };\n        }\n        if (this.errorStatus) {\n            this.workbook.buildErrors.push('Error building ' + this.address() + ': ' + this.errorStatus.text);\n            this.expression = function (ctx) {\n                var out = jsCalcValue.ErrorValue(jsCalcValue.jsCalcErrorValue.build, self, 'Error building ' + self.address());\n                return out;\n            };\n        }\n        this.value = jsCalcValue.ErrorValue(jsCalcValue.jsCalcErrorValue.uninitialized, this, 'Not yet initialized');\n        if (!this.isValue && this.parents.length == 0 && !this.errorStatus) {\n            this.isValue = true;\n            this.workbook.valueCells.push(this);\n        }\n        this.isBlank = false;\n    } else {\n        var tExpressionData = {\n            type: 'string',\n            value: ''\n        };\n        this.isValue = true;\n        this.isBlank = true;\n        this.workbook.valueCells.push(this);\n        this.expression = ExpressionBuilder.getEvalFunction(tExpressionData, this, true);\n    }\n    if (this.isValue) {\n        this.value = this.expression(this);\n        this.errorStatus = null;\n    }\n    this.dirty = true;\n};\ncalcExcelCell.prototype.reinit = function (expressionData, isBlank) {\n    this.debugExpressionData = expressionData;\n    var self = this;\n    this.removeParents();\n    this.cleanParentCount = 0;\n    this.workbook.removeValueCell(this);\n    this.isBlank = expressionData == 0 ? true : false;\n    this.breakIf();\n    if (expressionData) {\n        if (expressionData.type == 'value' || expressionData.type == 'string') {\n            this.workbook.valueCells.push(this);\n            this.isValue = true;\n        } else\n            this.isValue = false;\n        this.errorStatus = null;\n        try {\n            this.expression = ExpressionBuilder.getEvalFunction(expressionData, this, true);\n        } catch (e) {\n            var err = e;\n            this.workbook.buildErrors.push(e.toString());\n            this.expression = function (ctx) {\n                return jsCalcValue.ErrorValue(jsCalcValue.jsCalcErrorValue.build, self, err.toString());\n            };\n        }\n        if (this.errorStatus) {\n            this.workbook.buildErrors.push('Error building ' + this.address() + ': ' + this.errorStatus.text);\n            this.expression = function (ctx) {\n                var out = jsCalcValue.ErrorValue(jsCalcValue.jsCalcErrorValue.build, self, 'Error building ' + self.address());\n                return out;\n            };\n        }\n        this.value = jsCalcValue.ErrorValue(jsCalcValue.jsCalcErrorValue.uninitialized, this, 'Not yet initialized');\n        if (!this.isValue && this.parents.length == 0 && !this.errorStatus) {\n            this.isValue = true;\n            this.workbook.valueCells.push(this);\n        }\n        this.isBlank = false;\n    } else {\n        var tExpressionData = {\n            type: 'string',\n            value: ''\n        };\n        this.isValue = true;\n        this.isBlank = true;\n        this.workbook.valueCells.push(this);\n        this.expression = ExpressionBuilder.getEvalFunction(tExpressionData, this, true);\n    }\n    if (this.isValue) {\n        this.value = this.expression(this);\n        this.errorStatus = null;\n    }\n    this.processParents();\n    this.endirten();\n};\ncalcExcelCell.prototype.setFromString = function (expString) {\n};\ncalcExcelCell.prototype.setValue = function (value) {\n    if (value.toString() != this.value.s(this) && this.isValue) {\n        var curVal = jsCalcValue.makeValue(value);\n        this.expression = function () {\n            return curVal;\n        };\n        this.value = this.expression(this);\n        this.endirten();\n        this.workbook.calculationQueue.push(this);\n    }\n};\ncalcExcelCell.prototype.parentMadeUnclean = function () {\n    this.cleanParentCount--;\n};\ncalcExcelCell.prototype.parentMadeClean = function () {\n    this.cleanParentCount++;\n};\ncalcExcelCell.prototype.endirten = function () {\n    if (!this.dirty) {\n        this.dirty = true;\n        for (var i = 0; i < this.children.length; i++) {\n            this.children[i].parentMadeUnclean();\n            this.children[i].endirten();\n        }\n    }\n};\ncalcExcelCell.prototype.processParents = function () {\n    this.breakIf();\n    if (!this.isValue) {\n        var unique = {};\n        var outArray = [];\n        for (var i = 0; i < this.parents.length; i++) {\n            var curParentRef = this.parents[i];\n            if (curParentRef) {\n                try {\n                    curParentRef.eachCell(function () {\n                        var addStr = this.address();\n                        if (!unique.hasOwnProperty(addStr)) {\n                            if (!this.isBlank) {\n                                outArray.push(this);\n                                unique[addStr] = 1;\n                            }\n                        }\n                    });\n                } catch (e) {\n                    debugger;\n                    console.log('Error processing ', e);\n                    console.log(curParentRef);\n                }\n            }\n        }\n        this.parents = outArray;\n        var hasNonValueParent = false;\n        for (var i = 0; i < this.parents.length; i++) {\n            this.parents[i].addChild(this);\n            hasNonValueParent = hasNonValueParent || !this.parents[i].isValue;\n            \n        }\n        if (!hasNonValueParent)\n            this.workbook.valueCells.push(this);\n    }\n    if (this.parents.length > 30) {\n        this.workbook.lotsOfParents.push(this.address() + ': ' + this.parents.length);\n    }\n};\ncalcExcelCell.prototype.verboseAddress = function () {\n    return this.worksheet.name + '!R' + this.row + 'C' + this.col;\n};\ncalcExcelCell.prototype.v = function () {\n    return this.value.v(this);\n};\ncalcExcelCell.prototype.b = function () {\n    return this.value.b(this);\n};\ncalcExcelCell.prototype.num = function () {\n    return this.value.num(this);\n};\ncalcExcelCell.prototype.s = function () {\n    return this.value.s(this);\n};\ncalcExcelCell.prototype.breakIf = function () {\n    \n};\ncalcExcelCell.prototype.calculate = function () {\n    this.breakIf();\n    if (this.dirty) {\n        this.errorStatus = null;\n        this.value = this.expression(this);\n        this.dirty = false;\n        if (this.errorStatus) {\n            this.value = this.errorStatus;\n        } else {\n            var curVal = this.value.num(this);\n        }\n        this.flagChildrenToCalculate();\n    }\n};\ncalcExcelCell.prototype.flagChildrenToCalculate = function () {\n    for (var i = 0; i < this.children.length; i++) {\n        var curChild = this.children[i];\n        curChild.parentMadeClean();\n        this.children[i].flagCalculateIfParentsClean();\n    }\n};\ncalcExcelCell.prototype.flagCalculateIfParentsClean = function () {\n    var ready = this.parents.length == this.cleanParentCount;\n    if (ready)\n        this.workbook.calculationQueue.push(this);\n};\ncalcExcelCell.prototype.addParent = function (parentCell) {\n};\ncalcExcelCell.prototype.addChild = function (childCell) {\n    this.children.push(childCell);\n};\ncalcExcelCell.prototype.removeParents = function (parentCell) {\n    for (var i = 0; i < this.parents.length; i++) {\n        this.parents[i].removeChild(this);\n    }\n};\ncalcExcelCell.prototype.removeChild = function (childCell) {\n    for (var i = 0; i < this.children.length; i++) {\n        if (this.children[i] == childCell) {\n            this.children.splice(i, 1);\n        }\n    }\n};\ncalcExcelCell.prototype.address = function () {\n    return this.worksheet.name + '!R' + this.row + 'C' + this.col;\n};\nwindow.calcCell = calcExcelCell;\nvar calcCell$1 = window.calcCell;\n\nvar calcWorksheet = function (parentBook, worksheetName) {\n    this.parent = parentBook;\n    this.name = worksheetName;\n    this.rows = {};\n    this.namedRanges = {};\n    this.cellCount = 0;\n    this.cellArray = [];\n    this.hierarchyBuildCount = 0;\n    this.hierarchyReady = false;\n};\ncalcWorksheet.prototype.init = function (worksheetJson) {\n    this.initializeNamedRanges(worksheetJson.namedRanges);\n    for (var i = 0; i < worksheetJson.cells.length; i++) {\n        this.addCell(worksheetJson.cells[i]);\n    }\n    for (var row in this.rows) {\n        for (var col in this.rows[row]) {\n            this.cellArray.push(this.rows[row][col]);\n        }\n    }\n};\ncalcWorksheet.prototype.initializeNamedRanges = function (namedRangeJson) {\n    for (var namedRange in namedRangeJson) {\n        var namedRangeOb = namedRangeJson[namedRange];\n        var startRow = namedRangeOb.startRow;\n        var startCol = namedRangeOb.startCol;\n        var endRow = namedRangeOb.endRow ? namedRangeOb.endRow : startRow;\n        var endCol = namedRangeOb.endCol ? namedRangeOb.endCol : startCol;\n        var targetSheet = namedRangeOb.worksheet ? namedRangeOb.worksheet : this.name;\n        var refOb = jsCalcValue.ReferenceValue(startRow, startCol, endRow, endCol, { workbook: this.parent }, targetSheet);\n        this.namedRanges[namedRange] = refOb;\n    }\n};\ncalcWorksheet.prototype.addCell = function (cellJson) {\n    var targRow = cellJson.row;\n    var targCol = cellJson.col;\n    if (!this.rows[targRow])\n        this.rows[targRow] = {};\n    this.rows[targRow][targCol] = new calcCell$1(this, cellJson.row, cellJson.col, cellJson.expression);\n    if (cellJson.v)\n        this.rows[targRow][targCol].origValue = cellJson.v;\n    if (cellJson.f)\n        this.rows[targRow][targCol].formula = cellJson.f;\n    if (cellJson.nf)\n        this.rows[targRow][targCol].nf = cellJson.nf;\n    this.cellCount++;\n};\ncalcWorksheet.prototype.getCell = function (row, col) {\n    if (this.rows[row] && this.rows[row][col])\n        return this.rows[row][col];\n    else {\n        if (!this.rows[row])\n            this.rows[row] = {};\n        this.rows[row][col] = new calcCell$1(this, row, col, null, true);\n        return this.rows[row][col];\n    }\n};\ncalcWorksheet.prototype.initializeHierarchies = function () {\n    for (var row in this.rows) {\n        for (var col in this.rows[row]) {\n            this.rows[row][col].processParents();\n        }\n    }\n    this.hierarchyReady = true;\n};\ncalcWorksheet.prototype.initializeSingleCellHierarchyAsync = function () {\n    if (this.hierarchyBuildCount < this.cellArray.length) {\n        this.cellArray[this.hierarchyBuildCount].processParents();\n        this.hierarchyBuildCount++;\n    } else {\n        this.hierarchyReady = true;\n        this.parent.numBuilt--;\n    }\n};\n\nvar lastTime = 0;\nvar vendors = [\n    'webkit',\n    'moz'\n];\nfor (var x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {\n    window.requestAnimationFrame = window[vendors[x] + 'RequestAnimationFrame'];\n    window.cancelAnimationFrame = window[vendors[x] + 'CancelAnimationFrame'] || window[vendors[x] + 'CancelRequestAnimationFrame'];\n}\nif (!window.requestAnimationFrame)\n    window.requestAnimationFrame = function (callback, element) {\n        var currTime = new Date().getTime();\n        var timeToCall = Math.max(0, 16 - (currTime - lastTime));\n        var id = window.setTimeout(function () {\n            callback(currTime + timeToCall);\n        }, timeToCall);\n        lastTime = currTime + timeToCall;\n        return id;\n    };\nif (!window.cancelAnimationFrame)\n    window.cancelAnimationFrame = function (id) {\n        clearTimeout(id);\n    };\n\nvar parseUtils = {};\nparseUtils.range1Regex = /^(?:([a-zA-Z\\_\\-0-9]*)\\!)?\\$?([a-zA-Z]{1,2})\\$?([1-9][0-9]*)(?::\\$?([a-zA-Z]{1,2})\\$?([1-9][0-9]*))?$/i;\nparseUtils.rangeRCRegex = /^(?:([a-zA-Z\\_\\-0-9]*)\\!)?\\$?R([1-9][0-9]*)\\$?C([1-9][0-9]*)(?::\\$?R([1-9][0-9]*)\\$?C([1-9][0-9]*))?$/i;\nparseUtils.rangeColRegex = /^(?:([a-zA-Z\\_\\-0-9]*)\\!)?\\$?([a-zA-Z]{1,2})(?::\\$?([a-zA-Z]{1,2}))?$/i;\nparseUtils.rangeRowRegex = /^(?:([a-zA-Z\\_\\-0-9]*)\\!)?\\$?([1-9][0-9]*)(?::\\$?([1-9][0-9]*))?$/i;\nparseUtils.rangeMultiRegex = /^(?:([a-zA-Z\\_\\-0-9]*)\\!)?\\$?([a-zA-Z]{1,2})\\$?([1-9][0-9]*)(?::\\$?([a-zA-Z]{1,2})\\$?([1-9][0-9]*))(\\,(?:([a-zA-Z\\_\\-0-9]*)\\!)?\\$?([a-zA-Z]{1,2})\\$?([1-9][0-9]*)(?::\\$?([a-zA-Z]{1,2})\\$?([1-9][0-9]*)))+?$/i;\nparseUtils.getRCColumn = function (columnCode) {\n    var ACode = 'A'.charCodeAt(0) - 1;\n    var mult = 1;\n    var total = 0;\n    for (var i = columnCode.length - 1; i >= 0; i--) {\n        var curCharCode = columnCode.charCodeAt(i) - ACode;\n        total += curCharCode * mult;\n        mult *= 26;\n    }\n    return total;\n};\nparseUtils.getRangeOb = function (address) {\n    if (parseUtils.rangeRCRegex.test(address)) {\n        var out = {};\n        var regexOut = parseUtils.rangeRCRegex.exec(address);\n        out.sheetName = regexOut[1];\n        out.startRow = regexOut[2];\n        out.startCol = regexOut[3];\n        out.endRow = regexOut[4] ? regexOut[4] : out.startRow;\n        out.endCol = regexOut[5] ? regexOut[5] : out.startCol;\n        return out;\n    } else if (parseUtils.range1Regex.test(address)) {\n        var regexCapture = parseUtils.range1Regex.exec(address);\n        if (!regexCapture) {\n            if (parseUtils.rangeMultiRegex.test(address)) {\n                var addresses = address.split(',');\n                var outRanges = [];\n                for (var i = 0; i < addresses.length; i++) {\n                    var testRange = parseUtils.getRangeOb(addresses[i]);\n                    if (testRange)\n                        outRanges.push(testRange);\n                }\n                return outRanges;\n            } else if (parseUtils.rangeColRegex.test(address)) {\n                regexCapture = parseUtils.rangeColRegex.exec(address);\n                var out = {};\n                if (regexCapture[1])\n                    out.sheetName = regexCapture[1];\n                out.startCol = parseInt(regexCapture[2]);\n                out.endCol = parseInt(regexCapture[3]);\n                out.startRow = 1;\n                out.endRow = 65000;\n                return out;\n            } else if (parseUtils.rangeRowRegex.test(address)) {\n                regexCapture = parseUtils.rangeRowRegex.exec(address);\n                var out = {};\n                if (regexCapture[1])\n                    out.sheetName = regexCapture[1];\n                out.startRow = parseInt(regexCapture[2]);\n                out.endRow = parseInt(regexCapture[3]);\n                out.startCol = 1;\n                out.endCol = 216;\n                return out;\n            } else {\n                parseUtils.errorLog.push('Error attempting to parse address: ' + address);\n                return;\n            }\n        }\n        var out = {};\n        if (regexCapture[1])\n            out.sheetName = regexCapture[1];\n        out.startCol = parseInt(parseUtils.getRCColumn(regexCapture[2].toUpperCase()));\n        out.startRow = parseInt(regexCapture[3]);\n        if (regexCapture[4]) {\n            out.endCol = parseInt(parseUtils.getRCColumn(regexCapture[4].toUpperCase()));\n            out.endRow = parseInt(regexCapture[5]);\n        }\n        return out;\n    }\n};\n\nvar calcWorkbook = function (params) {\n    this.init(params);\n};\ncalcWorkbook.prototype.init = function (params) {\n    if (!params)\n        params = {};\n    this.calculationBreakpointObject = null;\n    if (params.modelJSON) {\n        this.workbookJson = params.modelJSON;\n    }\n    if (this.nextAnimFrame)\n        window.cancelAnimationFrame(this.nextAnimFrame);\n    if (!this.workbookJson)\n        return -1;\n    this.buildAsync = params.buildAsync ? true : false;\n    this.buildProgressCallback = params.buildProgressCallback;\n    this.name = this.workbookJson.name;\n    this.buildErrors = [];\n    this.calculationErrors = [];\n    this.namedRanges = {};\n    this.worksheets = {};\n    this.valueCells = [];\n    this.animFrameTimes = [];\n    this.unsupportedFunctionList = {};\n    this.calcCB = null;\n    this.calculationTimePerFrame = 20;\n    this.cellCount = 0;\n    this.queueEmpty = true;\n    this.startTime = 0;\n    this.endTime = 0;\n    this.calcTimeElapsed = 0;\n    this.calcCount = 0;\n    this.buildStartTime = new Date().getTime();\n    this.buildQueue = [];\n    this.buildStage = 0;\n    this.numBuilt = 0;\n    this.lotsOfParents = [];\n    this.buildMessage = 'Reticulating Splines';\n    this.addressReference = {};\n    ExpressionBuilder.activeWorkbook = this;\n    var self = this;\n    var worksheetName;\n    for (worksheetName in this.workbookJson.worksheets) {\n        this.worksheets[worksheetName] = new calcWorksheet(this, worksheetName);\n    }\n    this.initializeNamedRanges(this.workbookJson.namedRanges);\n    if (!this.buildAsync) {\n        for (worksheetName in this.workbookJson.worksheets) {\n            this.worksheets[worksheetName].init(this.workbookJson.worksheets[worksheetName]);\n            this.cellCount += this.worksheets[worksheetName].cellCount;\n        }\n        for (worksheetName in this.workbookJson.worksheets) {\n            this.worksheets[worksheetName].initializeHierarchies();\n        }\n        this.calculationQueue = this.valueCells.slice(0);\n        var self = this;\n        this.nextAnimFrame = window.requestAnimationFrame(function () {\n            self.processCalculation();\n        });\n    } else {\n        this.buildQueue.push({\n            buildFunc: function () {\n                self.buildStage = 1;\n                self.numBuilt = 0;\n                self.buildQueueOrigLength = self.cellCount + 1;\n                self.buildMessage = 'Building Cell Calculation Functions';\n            }\n        });\n        for (worksheetName in this.workbookJson.worksheets) {\n            this.buildQueue.push({\n                buildFunc: function (sheetName) {\n                    self.worksheets[sheetName].init(self.workbookJson.worksheets[sheetName]);\n                    self.cellCount += self.worksheets[sheetName].cellCount;\n                },\n                args: worksheetName\n            });\n        }\n        this.buildQueue.push({\n            buildFunc: function () {\n                self.buildStage = 1;\n                self.numBuilt = 0;\n                self.buildQueueOrigLength = self.cellCount + 1;\n                self.buildMessage = 'Calculating cell hierarchies';\n            }\n        });\n        for (worksheetName in this.workbookJson.worksheets) {\n            this.buildQueue.push({\n                buildFunc: function (args, ob) {\n                    self.asynchHierarchyBuildFunc(args, ob);\n                },\n                args: worksheetName\n            });\n        }\n        this.buildQueue.push({\n            buildFunc: function () {\n                self.calculationQueue = self.valueCells.slice(0);\n                self.nextAnimFrame = window.requestAnimationFrame(function () {\n                    self.processCalculation();\n                });\n            }\n        });\n        this.nextAnimFrame = window.requestAnimationFrame(function () {\n            self.asyncBuildWorkbook();\n        });\n        this.buildQueueOrigLength = this.buildQueue.length;\n    }\n};\ncalcWorkbook.prototype.asynchHierarchyBuildFunc = function (sheetName, buildOperationOb) {\n    this.worksheets[sheetName].initializeSingleCellHierarchyAsync();\n    if (!this.worksheets[sheetName].hierarchyReady) {\n        this.buildQueue.unshift(buildOperationOb);\n    }\n};\ncalcWorkbook.prototype.asyncBuildWorkbook = function () {\n    var startTime = new Date().getTime();\n    while (new Date().getTime() - startTime <= this.calculationTimePerFrame && this.buildQueue.length > 0) {\n        var curBuildOb = this.buildQueue.shift();\n        this.numBuilt++;\n        curBuildOb.buildFunc(curBuildOb.args, curBuildOb);\n    }\n    if (this.buildProgressCallback) {\n        var progOb = {\n            numComplete: this.numBuilt,\n            numTotal: this.buildQueueOrigLength,\n            message: this.buildMessage + ' (' + this.numBuilt + '/' + this.buildQueueOrigLength + ')',\n            curStage: this.buildStage\n        };\n        this.buildProgressCallback(progOb);\n    }\n    var self = this;\n    if (this.buildQueue.length > 0) {\n        this.nextAnimFrame = window.requestAnimationFrame(function () {\n            self.asyncBuildWorkbook();\n        });\n    } else {\n        this.calculationQueue = this.valueCells.slice(0);\n        this.nextAnimFrame = window.requestAnimationFrame(function () {\n            self.processCalculation();\n        });\n    }\n};\ncalcWorkbook.prototype.calculationPending = function () {\n    return this.calculationQueue.length > 0;\n};\ncalcWorkbook.prototype.processCalculation = function () {\n    var startTime = new Date().getTime();\n    if (this.calculationQueue.length > 0) {\n        if (this.queueEmpty) {\n            this.startTime = new Date().getTime();\n            this.endTime = 0;\n            this.calcTimeElapsed = 0;\n            this.calcCount = 0;\n            this.queueEmpty = false;\n        }\n        while (new Date().getTime() - startTime <= this.calculationTimePerFrame && this.calculationQueue.length > 0) {\n            var curCell = this.calculationQueue.shift();\n            try {\n                curCell.calculate();\n            } catch (e) {\n                this.calculationErrors.push(curCell.address() + ': ' + e.message);\n                var err = jsCalcValue.ErrorValue(jsCalcValue.jsCalcErrorValue.calc, curCell, e.message);\n                curCell.errorStatus = err;\n            }\n            this.calcCount++;\n        }\n        if (this.calculationQueue.length == 0) {\n            this.endTime = new Date().getTime();\n            this.calcTimeElapsed = this.endTime - this.startTime;\n            this.queueEmpty = true;\n            if (this.calcCB) {\n                if (this.calcCBOb) {\n                    this.calcCB.call(this.calcCBOb);\n                } else {\n                    this.calcCB();\n                }\n            }\n        }\n    }\n    var self = this;\n    this.nextAnimFrame = window.requestAnimationFrame(function () {\n        self.processCalculation();\n    });\n};\ncalcWorkbook.prototype.forceCalculate = function () {\n    this.startTime = new Date().getTime();\n    this.calcCount = 0;\n    var timeOut = 20000;\n    while (this.calculationQueue.length > 0 && new Date().getTime() - this.startTime < timeOut) {\n        var curCell = this.calculationQueue.shift();\n        curCell.calculate();\n        this.calcCount++;\n        if (this.calculationQueue.length == 0) {\n            this.endTime = new Date().getTime();\n            this.calcTimeElapsed = this.endTime - this.startTime;\n            if (this.calcCB) {\n                if (this.calcCBOb) {\n                    this.calcCB.call(this.calcCBOb);\n                } else {\n                    this.calcCB();\n                }\n            }\n        }\n    }\n};\ncalcWorkbook.prototype.onCalculationDone = function (calcCB) {\n    if (calcCB.length && calcCB.length >= 2 && typeof calcCB[1] == 'function') {\n        this.calcCBOb = calcCB[0];\n        this.calcCB = calcCB[1];\n    } else {\n        this.calcCBOb = null;\n        this.calcCB = calcCB;\n    }\n};\ncalcWorkbook.prototype.initializeNamedRanges = function (namedRangeJson) {\n    for (var namedRange in namedRangeJson) {\n        var namedRangeOb = namedRangeJson[namedRange];\n        var startRow = namedRangeOb.startRow;\n        var startCol = namedRangeOb.startCol;\n        var endRow = namedRangeOb.endRow ? namedRangeOb.endRow : startRow;\n        var endCol = namedRangeOb.endCol ? namedRangeOb.endCol : startCol;\n        var targetSheet = namedRangeOb.worksheet ? namedRangeOb.worksheet : null;\n        var refOb = jsCalcValue.ReferenceValue(startRow, startCol, endRow, endCol, { workbook: this }, targetSheet);\n        var addressRef = startRow === endRow && startCol === endCol ? targetSheet + '!' + 'R' + startRow + 'C' + endCol : targetSheet + '!' + 'R' + startRow + 'C' + startRow + ':R' + endRow + 'C' + endCol;\n        this.namedRanges[namedRange] = refOb;\n        this.addressReference[addressRef] = namedRange;\n    }\n};\ncalcWorkbook.prototype.getRangeReferenceByAddress = function (rangeSpecifierOb) {\n    var refOb = jsCalcValue.ReferenceValue(rangeSpecifierOb.startRow, rangeSpecifierOb.startCol, rangeSpecifierOb.endRow, rangeSpecifierOb.endCol, { workbook: this }, rangeSpecifierOb.sheetName);\n    return refOb;\n};\ncalcWorkbook.prototype.getRange = function (rangeID) {\n    if (this.namedRanges[rangeID]) {\n        return this.namedRanges[rangeID];\n    } else {\n        var rangeSpecifierOb = parseUtils.getRangeOb(rangeID);\n        return this.getRangeReferenceByAddress(rangeSpecifierOb);\n    }\n};\ncalcWorkbook.prototype.getFriendlyName = function (range) {\n    var self = this;\n    if (typeof self.addressReference[range] !== 'undefined') {\n        return self.addressReference[range];\n    }\n    return null;\n};\ncalcWorkbook.prototype.getNames = function (regex) {\n    var out = [];\n    for (var curName in this.namedRanges) {\n        if (typeof regex === 'RegExp') {\n            if (regex.test(curName)) {\n                out.push(curName);\n            }\n        }\n    }\n    return out;\n};\ncalcWorkbook.prototype.getValue = function (rangeID) {\n    var targRange = null;\n    if (this.isNamedRange(rangeID)) {\n        targRange = this.getRange(rangeID);\n    } else if (parseUtils.range1Regex.test(rangeID) || parseUtils.rangeRCRegex.test(rangeID)) {\n        var rangeSpecifierOb = parseUtils.getRangeOb(rangeID);\n        targRange = this.getRangeReferenceByAddress(rangeSpecifierOb);\n    }\n    if (!targRange)\n        return -1;\n    if (targRange.count == 1) {\n        var cell = targRange.getSingleCellReference();\n        return cell.v();\n    } else {\n        var out = [];\n        targRange.eachCell(function () {\n            out.push(this.v());\n        });\n        return out;\n    }\n};\ncalcWorkbook.prototype.removeValueCell = function (cell) {\n    for (var i = 0; i < this.valueCells.length; i++) {\n        if (this.valueCells[i] == cell) {\n            this.valueCells.splice(i, 1);\n            return;\n        }\n    }\n};\ncalcWorkbook.prototype.getContextualValue = function (rangeID, cellCtx) {\n    var targRange = null;\n    if (this.isNamedRange(rangeID)) {\n        targRange = this.getRange(rangeID);\n    } else if (parseUtils.range1Regex.test(rangeID) || parseUtils.rangeRCRegex.test(rangeID)) {\n        var rangeSpecifierOb = parseUtils.getRangeOb(rangeID);\n        targRange = this.getRangeReferenceByAddress(rangeSpecifierOb);\n    }\n    if (!targRange)\n        return -1;\n    if (targRange.count == 1) {\n        var cell = targRange.getSingleCellReference();\n        return cell.v(cellCtx);\n    } else {\n        return targRange.v(cellCtx);\n    }\n};\ncalcWorkbook.prototype.isNamedRange = function (name) {\n    return name in this.namedRanges;\n};\ncalcWorkbook.prototype.isWorksheet = function (name) {\n    return name in this.worksheets;\n};\ncalcWorkbook.prototype.recalculate = function (name) {\n    for (var i = 0; i < this.valueCells.length; i++) {\n        this.valueCells[i].endirten();\n    }\n    this.calculationQueue = this.valueCells.slice(0);\n};\n\nvar jsCalcVersion = 0.022;\nvar numeral = require('numeral');\nif (!window.isArray) {\n    window.isArray = function (obj) {\n        return Object.prototype.toString.call(obj) === '[object Array]';\n    };\n}\nvar jsCalc = function (params) {\n    this.versionNumber = jsCalcVersion;\n    this.periodName = params.hasOwnProperty('periodName') ? params.periodName : 'xxYear';\n    this.curPeriod = -1;\n    this.loadCallback = params.loadCallback;\n    this.buildProgressCallback = params.buildProgressCallback ? params.buildProgressCallback : null;\n    this.modelURL = params.modelURL ? params.modelURL : null;\n    this.model = params.model ? params.model : null;\n    this.buildAsync = params.hasOwnProperty('buildAsync') ? params.buildAsync : true;\n    this.workbook = null;\n    this.ready = false;\n    this.calculationCallbacks = [];\n    this.singletonCalculationCallbacks = [];\n    this.courseActions = params.customActions ? params.customActions : null;\n    this.stateVariables = {};\n    this.historicalData = {};\n    var self = this;\n    if (this.modelURL && this.loadCallback) {\n        $.ajax({\n            url: this.modelURL,\n            dataType: 'json',\n            complete: function (response) {\n                self.model = response.responseJSON;\n                self.buildFromJSON();\n            },\n            error: onError\n        });\n        this.initialized = true;\n    } else if (this.model && this.loadCallback) {\n        this.buildFromJSON();\n        this.initialized = true;\n    }\n};\nfunction onError(e) {\n    alert('Error: ' + e.toString());\n}\njsCalc.prototype.onNextRecalculate = function (nextRecalcFunc) {\n    this.singletonCalculationCallbacks.push(nextRecalcFunc);\n};\njsCalc.prototype.completeCalculation = function () {\n    var self = this;\n    return new Promise(function (resolve, reject) {\n        if (!self.workbook.calculationPending() && self.ready) {\n            resolve();\n        } else {\n            self.singletonCalculationCallbacks.push(function () {\n                self.completeCalculation().then(resolve);\n            });\n        }\n    });\n};\njsCalc.prototype.buildFromJSON = function (json) {\n    var self = this;\n    this.workbook = new calcWorkbook({\n        modelJSON: this.model,\n        buildProgressCallback: function (e) {\n            self.onBuildProgress(e);\n        },\n        buildAsync: this.buildAsync\n    });\n    var self = this;\n    this.workbook.onCalculationDone(function () {\n        self.curPeriod = self.getRawValue(self.periodName);\n        self.workbook.onCalculationDone([\n            self,\n            jsCalc.onCalculationDone\n        ]);\n        self.loadCallback();\n    });\n    this.ready = true;\n};\njsCalc.prototype.reset = function (params) {\n    var self = this;\n    this.ready = false;\n    params = params ? params : {};\n    this.loadCallback = params.loadCallback;\n    this.buildProgressCallback = params.buildProgressCallback ? params.buildProgressCallback : null;\n    this.workbook.init({\n        buildProgressCallback: function (e) {\n            self.onBuildProgress(e);\n        },\n        buildAsync: this.buildAsync\n    });\n    var self = this;\n    this.workbook.onCalculationDone(function () {\n        self.workbook.onCalculationDone([\n            self,\n            jsCalc.onCalculationDone\n        ]);\n        self.ready = true;\n        self.loadCallback();\n    });\n};\njsCalc.prototype.setValue = function (rangeID, value) {\n    var targRange = this.getRangeRef(rangeID);\n    if (!targRange || !targRange.targetSheetOb) {\n        return Promise.reject('Cannot set value: ' + value + '. No valid range found for: ' + rangeID);\n    }\n    if (window.isArray(value)) {\n        var endRow = targRange.h > value.length ? value.length : targRange.h;\n        for (var r = 0; r < endRow; r++) {\n            if (window.isArray(value[r])) {\n                var endCol = targRange.w > value[r].length ? value[r].length : targRange.w;\n                for (var c = 0; c < endCol; c++) {\n                    var targetRow = targRange.startRow + r;\n                    var targetCol = targRange.startCol + c;\n                    var address = targRange.targetSheetOb.name + '!R' + targetRow + 'C' + targetCol;\n                    this.setValue(address, value[r][c]);\n                }\n            }\n        }\n    } else {\n        var targRangeAddressString = targRange.targetSheetOb.name + '!R' + targRange.startRow + 'C' + targRange.startCol;\n        if (value == null)\n            value = '';\n        if (typeof value == 'string') {\n            var parsedVal = parseFloat(value);\n            if (!isNaN(parsedVal) && !isNaN(Number(value)))\n                value = parsedVal;\n        }\n        this.stateVariables[targRangeAddressString] = value;\n        targRange.get(0).setValue(value);\n    }\n    return this.completeCalculation();\n};\njsCalc.prototype.getRawValue = function (rangeID) {\n    var sourceRangeRef = this.getRangeRef(rangeID);\n    if (!sourceRangeRef)\n        return null;\n    var out = sourceRangeRef.valueArray();\n    if (out.length == 1 && out[0].length == 1)\n        return out[0][0];\n    return out;\n};\njsCalc.prototype.getValue = function (rangeID, period) {\n    if (period != 0 && period !== undefined && period.toString() != this.curPeriod.toString()) {\n        if (period < 0) {\n            period = this.curPeriod + period;\n        }\n        return this.getHistoricalValue(rangeID, period);\n    }\n    var sourceRangeRef = this.getRangeRef(rangeID);\n    if (!sourceRangeRef)\n        return null;\n    if (sourceRangeRef.h == 1 && sourceRangeRef.w == 1) {\n        var curCell = sourceRangeRef.getSingleCellReference();\n        var nf = curCell.nf;\n        var val = curCell.v();\n        if (!isNaN(parseFloat(val))) {\n            var nfCode = nf;\n            if (nf == 'General')\n                nfCode = '0,0';\n            var string = numeral(val).format(nfCode);\n            return string;\n        } else {\n            return val;\n        }\n    } else {\n        var out = sourceRangeRef.valueArray();\n        return out;\n    }\n};\njsCalc.prototype.getHistoricalValue = function (rangeID, period) {\n    if (this.historicalData[period]) {\n        if (this.historicalData[period].hasOwnProperty(rangeID)) {\n            return this.historicalData[period][rangeID];\n        } else {\n            return 'N/A';\n        }\n    } else {\n        return 'N/A';\n    }\n};\njsCalc.prototype.getSeriesValue = function (rangeID, period) {\n    if (period != 0 && period !== undefined && period.toString() != this.curPeriod.toString()) {\n        if (period < 0) {\n            period = this.curPeriod + period;\n        }\n        var out = this.getHistoricalValue(rangeID, period);\n        if (!window.isArray(out))\n            return [out];\n        var outArr = [];\n        for (var i = 0; i < out.length; i++) {\n            var curRow = out[i];\n            if (!window.isArray(curRow)) {\n                outArr.push(curRow);\n                continue;\n            }\n            for (var j = 0; j < curRow.length; j++) {\n                var curVal = curRow[j];\n                outArr.push(curVal);\n            }\n        }\n        return outArr;\n    }\n    var sourceRangeRef = this.getRangeRef(rangeID);\n    if (!sourceRangeRef)\n        return null;\n    if (sourceRangeRef.h == 1 && sourceRangeRef.w == 1) {\n        var curCell = sourceRangeRef.getSingleCellReference();\n        var val = curCell.v();\n        return [val];\n    } else {\n        var out = [];\n        sourceRangeRef.eachCell(function () {\n            out.push(this.v());\n        });\n        return out;\n    }\n};\njsCalc.prototype.addCalculationCallback = function (cbFunc) {\n    var found = false;\n    for (var i = 0; i < this.calculationCallbacks.length; i++) {\n        if (jsCalc.cbCompare(this.calculationCallbacks[i], cbFunc))\n            found = true;\n    }\n    if (!found) {\n        this.calculationCallbacks.push(cbFunc);\n    }\n};\njsCalc.prototype.removeCalculationCallback = function (cbFunc) {\n    for (var i = 0; i < this.calculationCallbacks.length; i++) {\n        if (jsCalc.cbCompare(this.calculationCallbacks[i], cbFunc)) {\n            this.calculationCallbacks.splice(i, 1);\n            i--;\n        }\n    }\n};\njsCalc.prototype.runCourseAction = function (actionName) {\n    var self = this;\n    return new Promise(function (resolve, reject) {\n        if (self.courseActions[actionName]) {\n            var prom = self.courseActions[actionName].call(self);\n            prom.then(function () {\n                resolve();\n            });\n        } else {\n            reject();\n        }\n    });\n};\njsCalc.prototype.getFullState = function () {\n    var outOb = {};\n    outOb.cells = {};\n    for (var trackedCell in this.stateVariables) {\n        var trackedVal = this.getRawValue(trackedCell);\n        outOb.cells[trackedCell] = trackedVal.toString();\n    }\n    outOb.historicalData = this.historicalData;\n    return outOb;\n};\njsCalc.prototype.getState = function () {\n    var outOb = {};\n    outOb = {};\n    for (var trackedCell in this.stateVariables) {\n        var trackedVal = this.getRawValue(trackedCell);\n        outOb[trackedCell] = trackedVal.toString();\n    }\n    return outOb;\n};\njsCalc.prototype.getHistoricalState = function () {\n    var outOb = {};\n    outOb.cells = {};\n    outOb = this.historicalData;\n    return outOb;\n};\njsCalc.prototype.getJSONState = function () {\n    return JSON.stringify(this.getState());\n};\njsCalc.prototype.setState = function (state, historicalState, callback) {\n    var stateObject = {};\n    stateObject.cells = state;\n    if (historicalState === undefined || historicalState === null) {\n        stateObject.historicalData = {};\n    } else {\n        stateObject.historicalData = historicalState;\n    }\n    var setCallback = callback;\n    this.reset({\n        loadCallback: function () {\n            for (cellAddress in stateObject.cells) {\n                var targRange = this.getRangeRef(cellAddress);\n                targRange.get(0).setValue(stateObject.cells[cellAddress]);\n            }\n            this.historicalData = stateObject.historicalData;\n            this.stateVariables = stateObject.cells;\n            if (setCallback)\n                setCallback();\n        }\n    });\n};\njsCalc.prototype.setJSONState = function (stateJSON, callback) {\n    var stateOb = JSON.parse(stateJSON);\n    this.setState(stateOb, callback);\n};\njsCalc.prototype.copyAndPasteByValue = function (sourceDataRange, destinationRange) {\n    var sourceRangeRef = this.getRangeRef(sourceDataRange);\n    var destinationRangeRef = this.getRangeRef(destinationRange);\n    if (!sourceRangeRef || !destinationRangeRef)\n        return -1;\n    if (sourceRangeRef.count == 1) {\n        var sourceValue = sourceRangeRef.getSingleCellReference().v();\n        for (var i = 0; i < destinationRangeRef.count; i++) {\n            this.setValue(destinationRangeRef.get(i).getSingleCellReference().address(), sourceValue);\n        }\n    } else {\n        var destTopLeft = destinationRangeRef.getSingleCellReference();\n        for (var r = 0; r < sourceRangeRef.h; r++) {\n            for (var c = 0; c < sourceRangeRef.w; c++) {\n                var targetRow = destTopLeft.row + r;\n                var targetCol = destTopLeft.col + c;\n                var targetAddress = destTopLeft.worksheet.name + '!R' + targetRow + 'C' + targetCol;\n                var sourceValue = sourceRangeRef.getCellByIndex(r, c).v();\n                this.setValue(targetAddress, sourceValue);\n            }\n        }\n    }\n};\njsCalc.prototype.isNamedRange = function (name) {\n    return this.workbook.isNamedRange(name);\n};\njsCalc.onCalculationDone = function () {\n    this.curPeriod = this.getRawValue(this.periodName);\n    for (var i = 0; i < this.singletonCalculationCallbacks.length; i++) {\n        var cbOb = this.singletonCalculationCallbacks[i];\n        if (cbOb.length >= 2 && typeof cbOb[1] == 'function') {\n            cbOb[1].call(cbOb[0]);\n        } else {\n            cbOb();\n        }\n    }\n    this.singletonCalculationCallbacks = [];\n    for (var i = 0; i < this.calculationCallbacks.length; i++) {\n        var cbOb = this.calculationCallbacks[i];\n        if (cbOb.length >= 2 && typeof cbOb[1] == 'function') {\n            cbOb[1].call(cbOb[0]);\n        } else {\n            cbOb();\n        }\n    }\n};\njsCalc.prototype.getRangeRef = function (rangeID) {\n    var targRange = null;\n    if (this.workbook.isNamedRange(rangeID)) {\n        targRange = this.workbook.getRange(rangeID);\n    } else if (parseUtils.range1Regex.test(rangeID) || parseUtils.rangeRCRegex.test(rangeID)) {\n        var rangeSpecifierOb = parseUtils.getRangeOb(rangeID);\n        targRange = this.workbook.getRangeReferenceByAddress(rangeSpecifierOb);\n    }\n    return targRange;\n};\njsCalc.prototype.setBuildProgressCallback = function (cbFunc) {\n    this.buildProgressCallback = cbFunc;\n};\njsCalc.prototype.onBuildProgress = function (progOb) {\n    if (this.buildProgressCallback) {\n        this.buildProgressCallback(progOb);\n    }\n};\njsCalc.cbCompare = function (a, b) {\n    if (typeof a == 'function' && typeof b == 'function') {\n        return a == b;\n    } else if (window.isArray(a) && window.isArray(b) && a.length >= 2 && b.length >= 2) {\n        return a[0] == b[0] && a[1] == b[1];\n    } else\n        return false;\n};\njsCalc.prototype.saveCurrentPeriodHistoricalData = function (periodRange) {\n    var periodRangeName = periodRange ? periodRange : 'xxYear';\n    var periodVal = this.getValue(periodRangeName);\n    var tlOutputRegex = /^tlOutput.*$/i;\n    var outputNames = this.workbook.getNames(tlOutputRegex);\n    var curDataSet = {};\n    for (var i = 0; i < outputNames.length; i++) {\n        var curName = outputNames[i];\n        curDataSet[curName] = this.getValue(curName);\n        if (typeof curDataSet[curName] == 'object' && !window.isArray(curDataSet[curName])) {\n            curDataSet[curName] = curDataSet[curName].data;\n        }\n    }\n    this.historicalData[periodVal] = curDataSet;\n};\njsCalc.prototype.getErrorList = function () {\n    var tlOutputRegex = '.';\n    var outputNames = this.workbook.getNames(tlOutputRegex);\n    for (var i = 0; i < outputNames.length; i++) {\n        var curName = outputNames[i];\n        if (this.getValue(curName) == '#UNINITIALIZED!') {\n            console.log(curName + ' = ' + this.getValue(curName));\n        }\n    }\n};\njsCalc.prototype.getBook = function () {\n    return this.workbook;\n};\njsCalc.prototype.isNamedRange = function (name) {\n    return this.workbook.isNamedRange(name);\n};\njsCalc.prototype.getFriendlyRangeName = function (address) {\n    return this.workbook.getFriendlyName(address);\n};\njsCalc.prototype.getNames = function (regExp) {\n    return this.workbook.getNames(regExp);\n};\njsCalc.prototype.addCourseActionBlock = function (actionObject) {\n    for (actionName in actionObject) {\n        this.addCourseAction(actionName, actionObject[actionName]);\n    }\n};\njsCalc.prototype.addCourseAction = function (name, actionFunction) {\n    this.courseActions[actionName] = actionFunction;\n};\n\nreturn jsCalc;\n\n})));\n//# sourceMappingURL=jsCalc.src.js.map\n"],"names":["global","factory","exports","module","define","amd","jsCalc","this","cleanFloat","number","getMean","dataArr","sum","i","length","onError","e","alert","toString","window","isArray","obj","Object","prototype","call","jsCalcValue","makeValue","value","val","toUpperCase","jsCalcBooleanValue","parseFloat","isNaN","Number","jsCalcNumValue","jsCalcStringValue","NumValue","ReferenceValue","startRow","startCol","endRow","endCol","cellCtx","sheetName","jsCalcReferenceValue","BooleanValue","StringValue","ErrorValue","ctx","text","jsCalcErrorValue","data","num","b","s","v","each","func","eachCell","isBlank","sheetOb","parseInt","h","w","count","index","colIndex","rowIndex","fullIndex","targetSheetOb","workbook","worksheets","worksheet","console","log","ref","getSingleCellReference","errorContext","Error","getReference","setValue","get","n","row","Math","floor","col","getCell","name","getByIndex","getCellByIndex","resize","address","out","getReferenceAsValueReference","r","c","cell","valueArray","outArray","curRow","push","dataVal","toUpper","errorStatus","uninitialized","divideByZero","nameErr","calc","build","na","jsCalcMulticellReferenceValue","refArray","refs","curArrayItem","WorksheetFunctions","sqrt2PI","sqrt","PI","recipSqrt2PI","SUM","argArray","curSum","curCtx","v1","PRODUCT","curProduct","IF","LARGE","valArray","numIndex","sort","a","NOT","Bval","ROW","INDEX","targ","ind","ind2","ISERROR","ISBLANK","testVal","IFERROR","VLOOKUP","exact","colOffset","testRange","testValue","isNumber","curTestCell","curTestVal","curIsNumber","toLowerCase","last","HLOOKUP","rowOffset","ABS","abs","AND","OR","IFNA","AVERAGE","CHOOSE","calcHelper","createConditionFunction","condition","conditionRef","regex","test","condString","regOut","exec","cmpNum","COUNTIF","curRange","condFunc","SUMIF","range","range2","MATCH","mode","MAX","max","calcCell","MIN","min","NA","NORMDIST","x","mean","dev","cum","invDev","curFunc","t","inExp","eExp","pow","E","curVal","cumul","numSteps","stepSize","NETWORKDAYS","rawStartDate","TimeToJavaScript","rawEndDate","startDate","Date","endDate","haveHolidays","numHolidays","excelHolidays","holidays","newHoliday","setHours","setMinutes","setSeconds","valueOf","curDate","dayOfWeek","getDay","skipHoliday","setDate","getDate","NOW","TimeToExcel","now","DAY","time","date","setTime","DATE","year","month","day","setMonth","setFullYear","getTime","MONTH","getMonth","EOMONTH","offset","getFullYear","nextMonth","newTime","YEAR","WEEKDAY","getWeek","startDay","excelStartDay","target","dayNr","firstDay","ceil","WEEKNUM","STDEVP","SSD","rootPart","SUMPRODUCT","FLOOR","multiple","ROUND","numPlaces","mult","round","ROUNDDOWN","ROUNDUP","RANK","order","greaterCount","lessCount","testNum","OFFSET","moveRowsBy","moveColsBy","numRowsToReturn","numColsToReturn","targetRangeStartRow","targetRangeStartCol","targetRangeEndRow","targetRangeEndCol","targetRangeSheetName","NPV","rate","j","idx","FORECAST","data_y_ranges","data_x_ranges","data_y","data_x","hasError","xmean","ymean","den","VALUE","LEFT","substring","RIGHT","LEN","SUBSTITUTE","oldText","newText","occurence","undefined","outVal","replace","RegExp","indexOf","IRR","values","guess","valuesArray","dates","positive","negative","newRate","epsRate","resultValue","resultRate","contLoop","result","irrResult","frac","irrResultDeriv","TRIM","tmptext","trim","INT","MOD","mod","ExpressionBuilder","valueFunctions","valueConstructorFunctions","operatorConstructorFunctions","resultTypes","generic","getEvalFunction","expression","asValue","type","constructFunc","operator","A","B","emptyStringFunction","referenceConstructorFunction","namedReferenceConstructorFunction","worksheetFunctionConstructor","string","bool","add","funcA","funcB","curExpression","sub","mul","exp","POSITIVE_INFINITY","NEGATIVE_INFINITY","div","eq","neq","lt","gt","lte","gte","cat","workbookOb","namedRanges","refOb","parents","targetSheet","referenceReturnFunction","wsFunc","expArgFuncArray","argExpressionArray","worksheetFunctionReturnFunction","errStr","verboseAddress","buildErrors","unsupportedFunctionList","args","curArgs","calcExcelCell","expressionData","debugExpressionData","self","parent","children","cleanParentCount","breakIf","valueCells","isValue","err","tExpressionData","dirty","reinit","removeParents","removeValueCell","processParents","endirten","setFromString","expString","calculationQueue","parentMadeUnclean","parentMadeClean","unique","curParentRef","addStr","hasOwnProperty","hasNonValueParent","addChild","lotsOfParents","calculate","flagChildrenToCalculate","flagCalculateIfParentsClean","addParent","parentCell","childCell","removeChild","splice","calcCell$1","calcWorksheet","parentBook","worksheetName","rows","cellCount","cellArray","hierarchyBuildCount","hierarchyReady","init","worksheetJson","initializeNamedRanges","cells","addCell","namedRangeJson","namedRange","namedRangeOb","cellJson","targRow","targCol","origValue","f","formula","nf","initializeHierarchies","initializeSingleCellHierarchyAsync","numBuilt","lastTime","vendors","requestAnimationFrame","cancelAnimationFrame","callback","element","currTime","timeToCall","id","setTimeout","clearTimeout","parseUtils","range1Regex","rangeRCRegex","rangeColRegex","rangeRowRegex","rangeMultiRegex","getRCColumn","columnCode","ACode","charCodeAt","total","getRangeOb","regexOut","regexCapture","addresses","split","outRanges","errorLog","calcWorkbook","params","calculationBreakpointObject","modelJSON","workbookJson","nextAnimFrame","buildAsync","buildProgressCallback","calculationErrors","animFrameTimes","calcCB","calculationTimePerFrame","queueEmpty","startTime","endTime","calcTimeElapsed","calcCount","buildStartTime","buildQueue","buildStage","buildMessage","addressReference","activeWorkbook","buildFunc","buildQueueOrigLength","ob","asynchHierarchyBuildFunc","slice","processCalculation","asyncBuildWorkbook","buildOperationOb","unshift","curBuildOb","shift","progOb","numComplete","numTotal","message","curStage","calculationPending","curCell","calcCBOb","forceCalculate","onCalculationDone","addressRef","getRangeReferenceByAddress","rangeSpecifierOb","getRange","rangeID","getFriendlyName","getNames","curName","getValue","targRange","isNamedRange","getContextualValue","isWorksheet","recalculate","numeral","require","versionNumber","periodName","curPeriod","loadCallback","modelURL","model","ready","calculationCallbacks","singletonCalculationCallbacks","courseActions","customActions","stateVariables","historicalData","$","ajax","url","dataType","complete","response","responseJSON","buildFromJSON","error","initialized","onNextRecalculate","nextRecalcFunc","completeCalculation","Promise","resolve","reject","then","json","onBuildProgress","getRawValue","reset","getRangeRef","targetRow","targetCol","targRangeAddressString","parsedVal","sourceRangeRef","period","getHistoricalValue","nfCode","format","getSeriesValue","outArr","addCalculationCallback","cbFunc","found","cbCompare","removeCalculationCallback","runCourseAction","actionName","getFullState","outOb","trackedCell","trackedVal","getState","getHistoricalState","getJSONState","JSON","stringify","setState","state","historicalState","stateObject","setCallback","cellAddress","setJSONState","stateJSON","stateOb","parse","copyAndPasteByValue","sourceDataRange","destinationRange","destinationRangeRef","sourceValue","destTopLeft","targetAddress","cbOb","setBuildProgressCallback","saveCurrentPeriodHistoricalData","periodRange","periodRangeName","periodVal","tlOutputRegex","outputNames","curDataSet","getErrorList","getBook","getFriendlyRangeName","regExp","addCourseActionBlock","actionObject","addCourseAction","actionFunction"],"mappings":"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"}